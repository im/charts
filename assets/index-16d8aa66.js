import{d as z,c as v,r as w,o as _,a as I,b as l,e as h,w as p,u as f,f as T,g as M,h as y,i as b,j as Y,k as Z,l as q,C as fe,m as _e,t as ee,n as U,p as te,q as ne,s as oe,_ as se,v as me,F as pe,x as he,y as ye,E as ge,z as ve}from"./index-3f354364.js";const we="/charts/logo.svg";function Ie(e){return{all:e=e||new Map,on:function(t,n){var o=e.get(t);o?o.push(n):e.set(t,[n])},off:function(t,n){var o=e.get(t);o&&(n?o.splice(o.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var o=e.get(t);o&&o.slice().map(function(s){s(n)}),(o=e.get("*"))&&o.slice().map(function(s){s(t,n)})}}}const re=Ie(),be={class:"topbar"},De={class:"logo",title:"charts"},xe=l("img",{src:we,alt:"charts"},null,-1),Be={class:"right"},ke=l("i",{class:"iconfont icon-jia"},null,-1),Ce=l("i",{class:"iconfont icon-jia"},null,-1),Ee=l("i",{class:"iconfont icon-search-2-copy"},null,-1),Me=z({__name:"topbar",setup(e){const t=Y(),n=v(()=>t.params.type),o=v(()=>n.value==="folder"),s=w(""),c=()=>{re.emit("createFolder","")};return(a,u)=>{const r=y("router-link"),i=y("el-button"),D=y("el-input");return _(),I("div",be,[l("h1",De,[h(r,{tag:"a",to:{name:"home"}},{default:p(()=>[xe,b(" Charts ")]),_:1})]),l("div",Be,[h(i,{size:"large"},{default:p(()=>[ke,b("新建图表 ")]),_:1}),f(o)?M("",!0):(_(),T(i,{key:0,size:"large",onClick:c},{default:p(()=>[Ce,b("新建文件夹 ")]),_:1})),h(D,{modelValue:s.value,"onUpdate:modelValue":u[0]||(u[0]=x=>s.value=x),size:"large",class:"search",placeholder:"在当前页面搜索"},{prefix:p(()=>[Ee]),_:1},8,["modelValue"])])])}}});const Fe="/charts/assets/folder-big-144a6fca.svg",Te="/charts/assets/plus-6fef50b3.svg",Se=e=>new URL(Object.assign({"../assets/images/folder-big.svg":Fe,"../assets/images/plus.svg":Te})[`../assets/images/${e}`],self.location).href,S=e=>(te("data-v-a674cc87"),e=e(),ne(),e),Le={class:"folder-box"},Oe=["src"],Ve=S(()=>l("div",{class:"operation"},[l("i",{class:"iconfont icon-gengduo"})],-1)),je=S(()=>l("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Pe=S(()=>l("i",{class:"iconfont icon-shanchu"},null,-1)),$e={class:"name"},Re=S(()=>l("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Ne=z({__name:"folder",props:{folder:{type:Object,default:()=>({})},editId:{type:Number,default:null}},emits:["change","del"],setup(e,{emit:t}){const n=e,o=oe(),s=w("未命名文件夹"),c=w(""),a=w(!1),u=w(null),r=()=>{a.value=!0,i()},i=()=>{U(()=>{var d;(d=u.value)==null||d.select()})},D=()=>{o.push({name:"home",params:{type:"folder",id:n.folder.id}})},x=()=>{s.value||(s.value=c.value),a.value=!1,t("change",{...n.folder,name:s.value})},O=()=>{x()},V=d=>{d==="del"&&t("del",n.folder),d==="edit"&&U(()=>{r()})},j=()=>{x()};return Z(()=>{s.value=n.folder.name,c.value=n.folder.name,n.folder.id===n.editId&&r()}),(d,m)=>{const B=y("el-dropdown-item"),P=y("el-dropdown-menu"),C=y("el-dropdown"),le=y("el-input");return _(),I("div",Le,[l("div",{class:"content",onClick:D},[l("img",{src:f(Se)("folder-big.svg")},null,8,Oe),h(C,{teleported:!1,onCommand:V},{dropdown:p(()=>[h(P,null,{default:p(()=>[h(B,{command:"edit"},{default:p(()=>[je,b(" 编辑 ")]),_:1}),h(B,{command:"del"},{default:p(()=>[Pe,b(" 删除 ")]),_:1})]),_:1})]),default:p(()=>[Ve]),_:1})]),l("div",$e,[a.value?q((_(),T(le,{key:0,ref_key:"inputRef",ref:u,modelValue:s.value,"onUpdate:modelValue":m[0]||(m[0]=ue=>s.value=ue),modelModifiers:{trim:!0},onKeydown:_e(O,["enter"])},null,8,["modelValue","onKeydown"])),[[f(fe),j]]):(_(),I("div",{key:1,class:"text",onClick:r},[b(ee(s.value)+" ",1),Re]))])])}}});const Ae=se(Ne,[["__scopeId","data-v-a674cc87"]]),N=(e,t)=>t.some(n=>e instanceof n);let H,G;function We(){return H||(H=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ke(){return G||(G=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ae=new WeakMap,A=new WeakMap,ce=new WeakMap,$=new WeakMap,L=new WeakMap;function ze(e){const t=new Promise((n,o)=>{const s=()=>{e.removeEventListener("success",c),e.removeEventListener("error",a)},c=()=>{n(g(e.result)),s()},a=()=>{o(e.error),s()};e.addEventListener("success",c),e.addEventListener("error",a)});return t.then(n=>{n instanceof IDBCursor&&ae.set(n,e)}).catch(()=>{}),L.set(t,e),t}function Ue(e){if(A.has(e))return;const t=new Promise((n,o)=>{const s=()=>{e.removeEventListener("complete",c),e.removeEventListener("error",a),e.removeEventListener("abort",a)},c=()=>{n(),s()},a=()=>{o(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",c),e.addEventListener("error",a),e.addEventListener("abort",a)});A.set(e,t)}let W={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return A.get(e);if(t==="objectStoreNames")return e.objectStoreNames||ce.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return g(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function ie(e){W=e(W)}function He(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const o=e.call(F(this),t,...n);return ce.set(o,t.sort?t.sort():[t]),g(o)}:Ke().includes(e)?function(...t){return e.apply(F(this),t),g(ae.get(this))}:function(...t){return g(e.apply(F(this),t))}}function Ge(e){return typeof e=="function"?He(e):(e instanceof IDBTransaction&&Ue(e),N(e,We())?new Proxy(e,W):e)}function g(e){if(e instanceof IDBRequest)return ze(e);if($.has(e))return $.get(e);const t=Ge(e);return t!==e&&($.set(e,t),L.set(t,e)),t}const F=e=>L.get(e);function Je(e,t,{blocked:n,upgrade:o,blocking:s,terminated:c}={}){const a=indexedDB.open(e,t),u=g(a);return o&&a.addEventListener("upgradeneeded",r=>{o(g(a.result),r.oldVersion,r.newVersion,g(a.transaction),r)}),n&&a.addEventListener("blocked",r=>n(r.oldVersion,r.newVersion,r)),u.then(r=>{c&&r.addEventListener("close",()=>c()),s&&r.addEventListener("versionchange",i=>s(i.oldVersion,i.newVersion,i))}).catch(()=>{}),u}const Qe=["get","getKey","getAll","getAllKeys","count"],Xe=["put","add","delete","clear"],R=new Map;function J(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(R.get(t))return R.get(t);const n=t.replace(/FromIndex$/,""),o=t!==n,s=Xe.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!(s||Qe.includes(n)))return;const c=async function(a,...u){const r=this.transaction(a,s?"readwrite":"readonly");let i=r.store;return o&&(i=i.index(u.shift())),(await Promise.all([i[n](...u),s&&r.done]))[0]};return R.set(t,c),c}ie(e=>({...e,get:(t,n,o)=>J(t,n)||e.get(t,n,o),has:(t,n)=>!!J(t,n)||e.has(t,n)}));const Ye=["continue","continuePrimaryKey","advance"],Q={},K=new WeakMap,de=new WeakMap,Ze={get(e,t){if(!Ye.includes(t))return e[t];let n=Q[t];return n||(n=Q[t]=function(...o){K.set(this,de.get(this)[t](...o))}),n}};async function*qe(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,Ze);for(de.set(n,t),L.set(n,F(t));t;)yield n,t=await(K.get(n)||t.continue()),K.delete(n)}function X(e,t){return t===Symbol.asyncIterator&&N(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&N(e,[IDBIndex,IDBObjectStore])}ie(e=>({...e,get(t,n,o){return X(t,n)?qe:e.get(t,n,o)},has(t,n){return X(t,n)||e.has(t,n)}}));const et="charts-",k="folder",tt=et+k,nt=1,E=Je(tt,nt,{upgrade(e){e.createObjectStore(k,{keyPath:"id",autoIncrement:!0}).createIndex("id","id",{unique:!0})}}),ot=me("Folder",{state:()=>({list:[]}),actions:{async update(){const e=await(await E).getAllFromIndex(k,"id");this.list=(e||[]).sort((t,n)=>n.updatedTime-t.updatedTime)},async get(e){return await(await E).get(k,e)},async set(e){const t=(await E).transaction(k,"readwrite");if(e.id){const n=t.store.index("id");for await(const o of n.iterate(e.id)){const s=Object.assign(o.value,e);o.update(s)}return await t.done,e.id}else{const n=await t.store.add(e);return this.update(),await t.done,n}},async del(e){await(await E).delete(k,e),this.update()}}}),st=e=>(te("data-v-4312f6e4"),e=e(),ne(),e),rt={class:"home"},at={class:"wrapper"},ct=st(()=>l("i",{class:"iconfont icon-fanhui"},null,-1)),it={class:"container"},dt=z({__name:"home",setup(e){const t=Y(),n=oe(),o=ot(),s=v(()=>o.list),c=v(()=>t.params.type),a=v(()=>+t.params.id),u=v(()=>c.value==="folder"),r=w(!0),i=w(null),D=v(()=>s.value.find(d=>d.id===a.value)),x=async()=>{const d={name:"未命名文件夹",createdTime:new Date().getTime(),updatedTime:new Date().getTime()},m=await o.set(d);i.value=m,setTimeout(()=>{i.value=""},100)},O=()=>{n.push({name:"home"})},V=d=>{const m=s.value.find(B=>B.id===d.id);m.name=d.name,m.updatedTime=new Date().getTime(),o.set(m)},j=d=>{ge.confirm("确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{o.del(d.id),ve({type:"success",message:"删除成功"})})};return re.on("createFolder",()=>{x()}),Z(async()=>{await o.update(),r.value=!1}),(d,m)=>{const B=y("el-empty"),P=ye("loading");return _(),I("div",rt,[h(f(Me)),q((_(),I("div",at,[f(u)&&f(D)?(_(),I("div",{key:0,class:"back",onClick:O},[ct,b(" "+ee(f(D).name),1)])):M("",!0),l("div",it,[f(u)?M("",!0):(_(!0),I(pe,{key:0},he(f(s),C=>(_(),T(f(Ae),{key:C.id,editId:i.value,folder:C,onChange:V,onDel:j},null,8,["editId","folder"]))),128)),!f(s).length&&!r.value?(_(),T(B,{key:1,description:"当前内容为空","image-size":200})):M("",!0)])])),[[P,r.value]])])}}});const ut=se(dt,[["__scopeId","data-v-4312f6e4"]]);export{ut as default};
