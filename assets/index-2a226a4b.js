import{e as W,_ as de,g as re,P as ne,D as ue,a as _e,u as se,b as me,F as L,c as pe}from"./lodash-0a69c344.js";import{d as K,u as ae,c as x,r as h,o as s,a as _,b as t,e as m,w as p,f as g,g as T,h as H,i as X,j as r,k as B,l as Y,C as le,m as D,n as ce,t as j,p as A,q as Z,s as ee,_ as G,v as U,F as M,x as he,y as q,z as fe,E as te,A as oe}from"./index-ea3582a9.js";const ve={class:"topbar"},we={class:"logo",title:"charts"},ye=t("img",{src:de,alt:"charts"},null,-1),ge={class:"right"},Ce=t("i",{class:"iconfont icon-jia"},null,-1),ke=K({__name:"topbar",setup(e){const a=ae(),n=x(()=>a.params.type);x(()=>n.value==="folder"),h("");const c=()=>{W.emit("createChart","")};return(o,f)=>{const i=g("router-link"),v=g("el-button");return s(),_("div",ve,[t("h1",we,[m(i,{tag:"a",to:{name:"home"}},{default:p(()=>[ye,T(" Charts ")]),_:1})]),t("div",ge,[m(v,{size:"large",onClick:c},{default:p(()=>[Ce,T("新建图表 ")]),_:1})])])}}});const J=e=>(Z("data-v-0fc7734e"),e=e(),ee(),e),be={class:"folder-box"},Te=["onClick"],xe=["src"],$e=J(()=>t("div",{class:"operation"},[t("i",{class:"iconfont icon-gengduo"})],-1)),Ie=J(()=>t("i",{class:"iconfont icon-weibiaoti520"},null,-1)),De=J(()=>t("i",{class:"iconfont icon-shanchu"},null,-1)),Se={class:"name"},Fe=J(()=>t("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Be=K({__name:"folder",props:{folder:{type:Object,default:()=>({})},editId:{type:Number,default:null}},emits:["change","del"],setup(e,{emit:a}){const n=e,c=H(),o=h("未命名文件夹"),f=h(""),i=h(!1),v=h(null),C=()=>{i.value=!0,k()},k=()=>{A(()=>{var u;(u=v.value)==null||u.select()})},w=()=>{c.push({name:"home",params:{type:"folder",id:n.folder.id}})},b=()=>{o.value||(o.value=f.value),i.value=!1,a("change",{...n.folder,name:o.value})},$=()=>{b()},S=u=>{u==="del"&&a("del",n.folder),u==="edit"&&A(()=>{C()})},E=()=>{b()};return X(()=>{o.value=n.folder.name,f.value=n.folder.name,n.folder.id===n.editId&&C()}),(u,d)=>{const I=g("el-dropdown-item"),V=g("el-dropdown-menu"),N=g("el-dropdown"),O=g("el-input");return s(),_("div",be,[t("div",{class:"content",onClick:B(w,["stop"])},[t("img",{src:r(re)("folder-big.svg")},null,8,xe),m(N,{teleported:!1,onCommand:S},{dropdown:p(()=>[m(V,null,{default:p(()=>[m(I,{command:"edit",onClick:d[0]||(d[0]=B(()=>{},["stop"]))},{default:p(()=>[Ie,T(" 编辑 ")]),_:1}),m(I,{command:"del",onClick:d[1]||(d[1]=B(()=>{},["stop"]))},{default:p(()=>[De,T(" 删除 ")]),_:1})]),_:1})]),default:p(()=>[$e]),_:1})],8,Te),t("div",Se,[i.value?Y((s(),D(O,{key:0,ref_key:"inputRef",ref:v,modelValue:o.value,"onUpdate:modelValue":d[2]||(d[2]=R=>o.value=R),modelModifiers:{trim:!0},onKeydown:ce($,["enter"])},null,8,["modelValue","onKeydown"])),[[r(le),E]]):(s(),_("div",{key:1,class:"text",onClick:C},[T(j(o.value)+" ",1),Fe]))])])}}});const Ee=G(Be,[["__scopeId","data-v-0fc7734e"]]),z=e=>(Z("data-v-5fda0373"),e=e(),ee(),e),Ve={class:"chart-box"},Ne=z(()=>t("i",{class:"iconfont icon-gengduo"},null,-1)),Oe=[Ne],Re=z(()=>t("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Me=z(()=>t("i",{class:"iconfont icon-shanchu"},null,-1)),je=z(()=>t("div",{class:"edit-box"},[t("span",null,"编辑")],-1)),Ae={class:"name"},Ke=z(()=>t("i",{class:"iconfont icon-weibiaoti520"},null,-1)),ze=K({__name:"chartItem",props:{chart:{type:Object,default:()=>({})},editId:{type:Number,default:null}},emits:["change","del"],setup(e,{emit:a}){const n=e,c=H(),o=h(""),f=h(""),i=h(!1),v=h(null),C=()=>{i.value=!0,k()},k=()=>{A(()=>{var u;(u=v.value)==null||u.select()})},w=()=>{c.push({name:"chart",params:{id:n.chart.id}})},b=()=>{o.value||(o.value=f.value),i.value=!1,a("change",{...n.chart,name:o.value})},$=()=>{b()},S=u=>{u==="del"&&a("del",n.chart),u==="edit"&&A(()=>{C()})},E=()=>{b()};return X(()=>{o.value=n.chart.name}),(u,d)=>{const I=g("el-dropdown-item"),V=g("el-dropdown-menu"),N=g("el-dropdown"),O=g("el-input");return s(),_("div",Ve,[t("div",{class:"content",onClick:w},[m(r(ne),{chart:e.chart},null,8,["chart"]),m(N,{teleported:!1,onCommand:S},{dropdown:p(()=>[m(V,null,{default:p(()=>[m(I,{command:"edit",onClick:d[1]||(d[1]=B(()=>{},["stop"]))},{default:p(()=>[Re,T(" 编辑 ")]),_:1}),m(I,{command:"del",onClick:d[2]||(d[2]=B(()=>{},["stop"]))},{default:p(()=>[Me,T(" 删除 ")]),_:1})]),_:1})]),default:p(()=>[t("div",{class:"operation",onClick:d[0]||(d[0]=B(()=>{},["stop"]))},Oe)]),_:1}),je]),t("div",Ae,[i.value?Y((s(),D(O,{key:0,ref_key:"inputRef",ref:v,modelValue:o.value,"onUpdate:modelValue":d[3]||(d[3]=R=>o.value=R),modelModifiers:{trim:!0},onKeydown:ce($,["enter"])},null,8,["modelValue","onKeydown"])),[[r(le),E]]):(s(),_("div",{key:1,class:"text",onClick:C},[t("span",null,j(o.value),1),T(),Ke]))])])}}});const Le=G(ze,[["__scopeId","data-v-5fda0373"]]);function qe(e){const a=e.value;return{data:ue[a],theme:"westeros",legend:!0,backgroundColor:"#ffffff",title:{show:!0,value:e.label,color:"#333333"},animation:{intervalTime:1,moveTime:.5,startDelayTime:0,endDelayTime:1,loop:0}}}const Pe={class:"container"},Ue={class:"chart-wrapper"},He=["onClick"],Ge={class:"tag"},Je={class:"preview"},Qe={class:"name-box"},We=K({__name:"chartTemplate",emits:["close"],setup(e,{emit:a}){H();const n=h(_e()),c=se(),o=()=>{a("close")},f=async i=>{const v={name:i.label,createdTime:new Date().getTime(),updatedTime:new Date().getTime(),type:i.value,config:qe(i)};await c.set(v),A(()=>{o()})};return(i,v)=>{const C=g("el-dialog");return s(),D(C,{fullscreen:!0,"model-value":!0,title:"图表模版","before-close":o},{default:p(()=>[t("div",Pe,[(s(!0),_(M,null,U(n.value,k=>(s(),_("div",{key:k.value,class:"chart-list"},[t("div",Ue,[(s(!0),_(M,null,U(k.children,w=>(s(),_("div",{key:w.value,class:"chart-block",onClick:b=>f(w)},[t("div",Ge,j(k.label),1),t("div",Je,[m(r(ne),{chart:w},null,8,["chart"])]),t("div",Qe,j(w.label),1)],8,He))),128))])]))),128))])]),_:1})}}});const Xe=G(We,[["__scopeId","data-v-e743a8fe"]]),P=me(),Ye=he("Folder",{state:()=>({list:[]}),actions:{async update(){const e=await(await P).getAllFromIndex(L,"id");this.list=(e||[]).sort((a,n)=>n.updatedTime-a.updatedTime)},async get(e){return await(await P).get(L,e)},async set(e){const a=(await P).transaction(L,"readwrite");if(e.id){const n=a.store.index("id");for await(const c of n.iterate(e.id)){const o=Object.assign(c.value,e);c.update(o)}return await a.done,e.id}else{const n=await a.store.add(e);return this.update(),await a.done,n}},async del(e){await(await P).delete(L,e),this.update()}}}),Ze=e=>(Z("data-v-b0b5e834"),e=e(),ee(),e),et={class:"home"},tt={class:"wrapper"},ot=Ze(()=>t("i",{class:"iconfont icon-fanhui"},null,-1)),nt={class:"container"},st=K({__name:"home",setup(e){const a=ae(),n=H(),c=Ye(),o=se(),f=x(()=>c.list),i=x(()=>o.list),v=x(()=>a.params.type),C=x(()=>+a.params.id),k=x(()=>v.value==="folder"),w=h(!0),b=h(null),$=h(!1),S=x(()=>f.value.find(l=>l.id===C.value)),E=async()=>{const l={name:"未命名文件夹",createdTime:new Date().getTime(),updatedTime:new Date().getTime()},y=await c.set(l);b.value=y,setTimeout(()=>{b.value=""},100)},u=()=>{n.push({name:"home"})},d=l=>{const y=f.value.find(Q=>Q.id===l.id);y.name=l.name,y.updatedTime=new Date().getTime(),c.set(y)},I=l=>{const y=pe.cloneDeep(l);y.updatedTime=new Date().getTime(),o.set(y)},V=l=>{te.confirm("确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{c.del(l.id),oe({type:"success",message:"删除成功"})})},N=l=>{te.confirm("确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{o.del(l.id),oe({type:"success",message:"删除成功"})})},O=()=>{$.value=!0};W.on("createFolder",()=>{E()}),W.on("createChart",()=>{O()});const R=()=>{const l=new BroadcastChannel("chart");l.onmessage=async y=>{await c.update(),await o.update()}};return X(async()=>{var l;(l=document.querySelector("html"))==null||l.classList.remove("dark"),await c.update(),await o.update(),w.value=!1,R()}),(l,y)=>{const Q=g("el-empty"),ie=fe("loading");return s(),_("div",et,[m(r(ke)),Y((s(),_("div",tt,[r(k)&&r(S)?(s(),_("div",{key:0,class:"back",onClick:u},[ot,T(" "+j(r(S).name),1)])):q("",!0),t("div",nt,[r(k)?q("",!0):(s(),_(M,{key:0},[(s(!0),_(M,null,U(r(f),F=>(s(),D(r(Ee),{key:F.id,editId:b.value,folder:F,onChange:d,onDel:V},null,8,["editId","folder"]))),128)),(s(!0),_(M,null,U(r(i),F=>(s(),D(r(Le),{key:F.id,chart:F,onChange:I,onDel:N},null,8,["chart"]))),128))],64))]),!r(f).length&&!r(i).length&&!w.value?(s(),D(Q,{key:1,description:"当前内容为空","image-size":200})):q("",!0),$.value?(s(),D(r(Xe),{key:2,onClose:y[0]||(y[0]=F=>$.value=!1)})):q("",!0)])),[[ie,w.value]])])}}});const ct=G(st,[["__scopeId","data-v-b0b5e834"]]);export{ct as default};
