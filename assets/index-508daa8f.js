import{e as P,g as de,P as ne,a as re,u as se,D as ue,F as H}from"./chart-82d0691a.js";import{d as z,u as ae,c as S,r as b,o as s,a as h,b as o,e as f,w as p,f as l,g as F,h as M,i as g,j as I,k as Y,l as Q,m as O,n as W,C as le,p as ce,t as K,q as U,s as Z,v as ee,_ as q,x as G,F as j,y as _e,z as pe,E as te,A as oe}from"./index-d5faa2f5.js";const me="/charts/logo.svg",he={class:"topbar"},fe={class:"logo",title:"charts"},ve=o("img",{src:me,alt:"charts"},null,-1),we={class:"right"},ye=o("i",{class:"iconfont icon-jia"},null,-1),ge=o("i",{class:"iconfont icon-jia"},null,-1),Ce=o("i",{class:"iconfont icon-search-2-copy"},null,-1),ke=z({__name:"topbar",setup(e){const a=ae(),n=S(()=>a.params.type),c=S(()=>n.value==="folder"),t=b(""),m=()=>{P.emit("createFolder","")},v=()=>{P.emit("createChart","")};return(C,w)=>{const x=g("router-link"),y=g("el-button"),i=g("el-input");return s(),h("div",he,[o("h1",fe,[f(x,{tag:"a",to:{name:"home"}},{default:p(()=>[ve,I(" Charts ")]),_:1})]),o("div",we,[f(y,{size:"large",onClick:v},{default:p(()=>[ye,I("新建图表 ")]),_:1}),l(c)?M("",!0):(s(),F(y,{key:0,size:"large",onClick:m},{default:p(()=>[ge,I("新建文件夹 ")]),_:1})),f(i,{modelValue:t.value,"onUpdate:modelValue":w[0]||(w[0]=u=>t.value=u),size:"large",class:"search",placeholder:"在当前页面搜索"},{prefix:p(()=>[Ce]),_:1},8,["modelValue"])])])}}});const X=e=>(Z("data-v-0fc7734e"),e=e(),ee(),e),be={class:"folder-box"},xe=["onClick"],Ie=["src"],Te=X(()=>o("div",{class:"operation"},[o("i",{class:"iconfont icon-gengduo"})],-1)),$e=X(()=>o("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Se=X(()=>o("i",{class:"iconfont icon-shanchu"},null,-1)),Fe={class:"name"},De=X(()=>o("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Be=z({__name:"folder",props:{folder:{type:Object,default:()=>({})},editId:{type:Number,default:null}},emits:["change","del"],setup(e,{emit:a}){const n=e,c=Y(),t=b("未命名文件夹"),m=b(""),v=b(!1),C=b(null),w=()=>{v.value=!0,x()},x=()=>{U(()=>{var d;(d=C.value)==null||d.select()})},y=()=>{c.push({name:"home",params:{type:"folder",id:n.folder.id}})},i=()=>{t.value||(t.value=m.value),v.value=!1,a("change",{...n.folder,name:t.value})},u=()=>{i()},T=d=>{d==="del"&&a("del",n.folder),d==="edit"&&U(()=>{w()})},N=()=>{i()};return Q(()=>{t.value=n.folder.name,m.value=n.folder.name,n.folder.id===n.editId&&w()}),(d,r)=>{const $=g("el-dropdown-item"),D=g("el-dropdown-menu"),V=g("el-dropdown"),A=g("el-input");return s(),h("div",be,[o("div",{class:"content",onClick:O(y,["stop"])},[o("img",{src:l(de)("folder-big.svg")},null,8,Ie),f(V,{teleported:!1,onCommand:T},{dropdown:p(()=>[f(D,null,{default:p(()=>[f($,{command:"edit",onClick:r[0]||(r[0]=O(()=>{},["stop"]))},{default:p(()=>[$e,I(" 编辑 ")]),_:1}),f($,{command:"del",onClick:r[1]||(r[1]=O(()=>{},["stop"]))},{default:p(()=>[Se,I(" 删除 ")]),_:1})]),_:1})]),default:p(()=>[Te]),_:1})],8,xe),o("div",Fe,[v.value?W((s(),F(A,{key:0,ref_key:"inputRef",ref:C,modelValue:t.value,"onUpdate:modelValue":r[2]||(r[2]=E=>t.value=E),modelModifiers:{trim:!0},onKeydown:ce(u,["enter"])},null,8,["modelValue","onKeydown"])),[[l(le),N]]):(s(),h("div",{key:1,class:"text",onClick:w},[I(K(t.value)+" ",1),De]))])])}}});const Ne=q(Be,[["__scopeId","data-v-0fc7734e"]]),J=e=>(Z("data-v-436a253b"),e=e(),ee(),e),Ve={class:"chart-box"},Ae=J(()=>o("div",{class:"operation"},[o("i",{class:"iconfont icon-gengduo"})],-1)),Ee=J(()=>o("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Re=J(()=>o("i",{class:"iconfont icon-shanchu"},null,-1)),Me={class:"name"},Oe=J(()=>o("i",{class:"iconfont icon-weibiaoti520"},null,-1)),je=z({__name:"chartItem",props:{chart:{type:Object,default:()=>({})},editId:{type:Number,default:null}},emits:["change","del"],setup(e,{emit:a}){const n=e,c=Y(),t=b(""),m=b(""),v=b(!1),C=b(null),w=()=>{v.value=!0,x()},x=()=>{U(()=>{var d;(d=C.value)==null||d.select()})},y=()=>{const{href:d}=c.resolve({name:"chart",params:{id:n.chart.id}}),{origin:r,pathname:$}=window.location,D=r+$+d;window.open(D,"_blank")},i=()=>{t.value||(t.value=m.value),v.value=!1,a("change",{...n.chart,name:t.value})},u=()=>{i()},T=d=>{d==="del"&&a("del",n.chart),d==="edit"&&U(()=>{w()})},N=()=>{i()};return Q(()=>{t.value=n.chart.name}),(d,r)=>{const $=g("el-dropdown-item"),D=g("el-dropdown-menu"),V=g("el-dropdown"),A=g("el-input");return s(),h("div",Ve,[o("div",{class:"content",onClick:y},[f(l(ne),{chart:e.chart},null,8,["chart"]),f(V,{teleported:!1,onCommand:T},{dropdown:p(()=>[f(D,null,{default:p(()=>[f($,{command:"edit",onClick:r[0]||(r[0]=O(()=>{},["stop"]))},{default:p(()=>[Ee,I(" 编辑 ")]),_:1}),f($,{command:"del",onClick:r[1]||(r[1]=O(()=>{},["stop"]))},{default:p(()=>[Re,I(" 删除 ")]),_:1})]),_:1})]),default:p(()=>[Ae]),_:1})]),o("div",Me,[v.value?W((s(),F(A,{key:0,ref_key:"inputRef",ref:C,modelValue:t.value,"onUpdate:modelValue":r[2]||(r[2]=E=>t.value=E),modelModifiers:{trim:!0},onKeydown:ce(u,["enter"])},null,8,["modelValue","onKeydown"])),[[l(le),N]]):(s(),h("div",{key:1,class:"text",onClick:w},[o("span",null,K(t.value),1),I(),Oe]))])])}}});const Ke=q(je,[["__scopeId","data-v-436a253b"]]),ze=[["","Ford","Volvo","Toyota","Honda"],["2016",100,11,12,13],["2017",140,11,14,160],["2018",300,120,12,140]],He=[["","xxx","aaa","bb","Honda"],["2016",10,11,12,13],["2017",200,11,14,13],["2020",30,15,12,13]],Le=[["","Ford","Volvo","Toyota","Honda"],["2016",10,11,12,13],["2017",20,11,14,13],["2018",30,15,12,13]],Pe=[["","受教育水平","占比（%）"],["大学本科",10],["大学专科",20],["硕士",30],["高中及以下",28],["博士及以上",80]],Ue=[["","Ford","Volvo","Toyota","Honda"],["2016",10,11,12,13],["2017",20,11,14,13],["2018",30,15,12,13]],Ge=[["","受教育水平","占比（%）"],["大学本科",10],["大学专科",20],["硕士",30],["高中及以下",28],["博士及以上",80]],Ye={DYNAMIC_LINE_BAR_MIX:ze,DYNAMIC_RANKING_BAR:He,LINE_BASICS:Le,PIE_BASICS:Pe,BAR_BASICS:Ue,RING_BASICS:Ge};function qe(e){e.label;const a=e.value;return{data:Ye[a]}}const Xe={class:"container"},Je={class:"chart-wrapper"},Qe=["onClick"],We={class:"preview"},Ze={class:"name-box"},et=z({__name:"chartTemplate",emits:["close"],setup(e,{emit:a}){const n=Y(),c=b(re()),t=se(),m=()=>{a("close")},v=async C=>{const w={name:C.label,createdTime:new Date().getTime(),updatedTime:new Date().getTime(),type:C.value,config:qe(C)},x=await t.set(w),{href:y}=n.resolve({name:"chart",params:{id:x}}),{origin:i,pathname:u}=window.location,T=i+u+y;window.open(T,"_blank"),m()};return(C,w)=>{const x=g("el-divider"),y=g("el-dialog");return s(),F(y,{fullscreen:!0,"model-value":!0,title:"图表模版","before-close":m},{default:p(()=>[o("div",Xe,[(s(!0),h(j,null,G(c.value,i=>(s(),h("div",{key:i.value},[f(x,{"content-position":"left"},{default:p(()=>[I(K(i.label),1)]),_:2},1024),o("div",Je,[(s(!0),h(j,null,G(i.children,u=>(s(),h("div",{key:u.value,class:"chart-block",onClick:T=>v(u)},[o("div",We,[f(l(ne),{chart:u},null,8,["chart"])]),o("div",Ze,K(u.label),1)],8,Qe))),128))])]))),128))])]),_:1})}}});const tt=q(et,[["__scopeId","data-v-e661c407"]]),L=ue(),ot=_e("Folder",{state:()=>({list:[]}),actions:{async update(){const e=await(await L).getAllFromIndex(H,"id");this.list=(e||[]).sort((a,n)=>n.updatedTime-a.updatedTime)},async get(e){return await(await L).get(H,e)},async set(e){const a=(await L).transaction(H,"readwrite");if(e.id){const n=a.store.index("id");for await(const c of n.iterate(e.id)){const t=Object.assign(c.value,e);c.update(t)}return await a.done,e.id}else{const n=await a.store.add(e);return this.update(),await a.done,n}},async del(e){await(await L).delete(H,e),this.update()}}}),nt=e=>(Z("data-v-142c4a35"),e=e(),ee(),e),st={class:"home"},at={class:"wrapper"},lt=nt(()=>o("i",{class:"iconfont icon-fanhui"},null,-1)),ct={class:"container"},it=z({__name:"home",setup(e){const a=ae(),n=Y(),c=ot(),t=se(),m=S(()=>c.list),v=S(()=>t.list),C=S(()=>a.params.type),w=S(()=>+a.params.id),x=S(()=>C.value==="folder"),y=b(!0),i=b(null),u=b(!1),T=S(()=>m.value.find(_=>_.id===w.value)),N=async()=>{const _={name:"未命名文件夹",createdTime:new Date().getTime(),updatedTime:new Date().getTime()},k=await c.set(_);i.value=k,setTimeout(()=>{i.value=""},100)},d=()=>{n.push({name:"home"})},r=_=>{const k=m.value.find(R=>R.id===_.id);k.name=_.name,k.updatedTime=new Date().getTime(),c.set(k)},$=_=>{const k=m.value.find(R=>R.id===_.id);k.name=_.name,k.updatedTime=new Date().getTime(),t.set(k)},D=_=>{te.confirm("确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{c.del(_.id),oe({type:"success",message:"删除成功"})})},V=_=>{te.confirm("确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{t.del(_.id),oe({type:"success",message:"删除成功"})})},A=()=>{u.value=!0};P.on("createFolder",()=>{N()}),P.on("createChart",()=>{A()});const E=()=>{const _=new BroadcastChannel("chart");_.onmessage=async k=>{await c.update(),await t.update()}};return Q(async()=>{await c.update(),await t.update(),y.value=!1,E()}),(_,k)=>{const R=g("el-empty"),ie=pe("loading");return s(),h("div",st,[f(l(ke)),W((s(),h("div",at,[l(x)&&l(T)?(s(),h("div",{key:0,class:"back",onClick:d},[lt,I(" "+K(l(T).name),1)])):M("",!0),o("div",ct,[l(x)?M("",!0):(s(),h(j,{key:0},[(s(!0),h(j,null,G(l(m),B=>(s(),F(l(Ne),{key:B.id,editId:i.value,folder:B,onChange:r,onDel:D},null,8,["editId","folder"]))),128)),(s(!0),h(j,null,G(l(v),B=>(s(),F(l(Ke),{key:B.id,chart:B,onChange:$,onDel:V},null,8,["chart"]))),128))],64))]),!l(m).length&&!l(v).length&&!y.value?(s(),F(R,{key:1,description:"当前内容为空","image-size":200})):M("",!0),u.value?(s(),F(l(tt),{key:2,onClose:k[0]||(k[0]=B=>u.value=!1)})):M("",!0)])),[[ie,y.value]])])}}});const ut=q(it,[["__scopeId","data-v-142c4a35"]]);export{ut as default};
