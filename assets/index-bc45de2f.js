import{d as k,r as b,o as m,c as I,a as l,b as f,w as p,e as D,f as g,g as $,u as v,h as q,C as ee,i as S,j as te,t as ne,n as oe,p as se,k as re,_ as P,l as ae,m as ce,F as ie,q as de,s as le,E as O,v as ue}from"./index-9a2b3e51.js";const _e="/charts/logo.svg";function pe(e){return{all:e=e||new Map,on:function(t,n){var o=e.get(t);o?o.push(n):e.set(t,[n])},off:function(t,n){var o=e.get(t);o&&(n?o.splice(o.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var o=e.get(t);o&&o.slice().map(function(r){r(n)}),(o=e.get("*"))&&o.slice().map(function(r){r(t,n)})}}}const K=pe(),me={class:"topbar"},fe=l("h1",{class:"logo",title:"charts"},[l("a",{href:"/charts/"},[l("img",{src:_e,alt:"charts"}),D(" Charts ")])],-1),he={class:"right"},ge=l("i",{class:"iconfont icon-jia"},null,-1),ye=l("i",{class:"iconfont icon-jia"},null,-1),we=l("i",{class:"iconfont icon-search-2-copy"},null,-1),ve=k({__name:"topbar",setup(e){const t=b(""),n=()=>{K.emit("createFolder","")};return(o,r)=>{const a=g("el-button"),s=g("el-input");return m(),I("div",me,[fe,l("div",he,[f(a,{size:"large"},{default:p(()=>[ge,D("新建图表 ")]),_:1}),f(a,{size:"large",onClick:n},{default:p(()=>[ye,D("新建文件夹 ")]),_:1}),f(s,{modelValue:t.value,"onUpdate:modelValue":r[0]||(r[0]=d=>t.value=d),size:"large",class:"search",placeholder:"在当前页面搜索"},{prefix:p(()=>[we]),_:1},8,["modelValue"])])])}}});const De="/charts/assets/folder-big-144a6fca.svg",be="/charts/assets/plus-6fef50b3.svg",Ie=e=>new URL(Object.assign({"../assets/images/folder-big.svg":De,"../assets/images/plus.svg":be})[`../assets/images/${e}`],self.location).href,x=e=>(se("data-v-0ac54f55"),e=e(),re(),e),Ee={class:"folder-box"},xe={class:"content"},Be=["src"],Ce=x(()=>l("div",{class:"operation"},[l("i",{class:"iconfont icon-gengduo"})],-1)),Me=x(()=>l("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Se=x(()=>l("i",{class:"iconfont icon-gengduo"},null,-1)),Te={class:"name"},Ve=x(()=>l("i",{class:"iconfont icon-weibiaoti520"},null,-1)),ke=k({__name:"folder",props:{folder:{type:Object,default:()=>({})}},emits:["change","del"],setup(e,{emit:t}){const n=e,o=b("未命名文件夹"),r=b(""),a=b(!1),s=b(null),d=()=>{a.value=!0,c()},c=()=>{oe(()=>{var y;(y=s.value)==null||y.select()})},u=()=>{o.value||(o.value=r.value),a.value=!1,t("change",{...n.folder,name:o.value})},H=()=>{u()},G=y=>{y==="del"&&t("del",n.folder),y==="edit"&&d()},J=()=>{u()};return $(()=>{o.value=n.folder.name,r.value=n.folder.name,n.folder.isEdit&&d()}),(y,F)=>{const j=g("el-dropdown-item"),Q=g("el-dropdown-menu"),X=g("el-dropdown"),Y=g("el-input");return m(),I("div",Ee,[l("div",xe,[l("img",{src:v(Ie)("folder-big.svg")},null,8,Be),f(X,{teleported:!1,onCommand:G},{dropdown:p(()=>[f(Q,null,{default:p(()=>[f(j,{command:"edit"},{default:p(()=>[Me,D(" 编辑 ")]),_:1}),f(j,{command:"del"},{default:p(()=>[Se,D(" 删除 ")]),_:1})]),_:1})]),default:p(()=>[Ce]),_:1})]),l("div",Te,[a.value?q((m(),S(Y,{key:0,ref_key:"inputRef",ref:s,modelValue:o.value,"onUpdate:modelValue":F[0]||(F[0]=Z=>o.value=Z),modelModifiers:{trim:!0},onKeydown:te(H,["enter"])},null,8,["modelValue","onKeydown"])),[[v(ee),J]]):(m(),I("div",{key:1,class:"text",onClick:d},[D(ne(o.value)+" ",1),Ve]))])])}}});const Le=P(ke,[["__scopeId","data-v-0ac54f55"]]);let E;const Fe=new Uint8Array(16);function je(){if(!E&&(E=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!E))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return E(Fe)}const i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));function Oe(e,t=0){return(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase()}const Re=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),R={randomUUID:Re};function Ue(e,t,n){if(R.randomUUID&&!t&&!e)return R.randomUUID();e=e||{};const o=e.random||(e.rng||je)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,t){n=n||0;for(let r=0;r<16;++r)t[n+r]=o[r];return t}return Oe(o)}const Ae=(e,t)=>t.some(n=>e instanceof n);let U,A;function Ne(){return U||(U=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function $e(){return A||(A=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const W=new WeakMap,T=new WeakMap,z=new WeakMap,B=new WeakMap,L=new WeakMap;function Pe(e){const t=new Promise((n,o)=>{const r=()=>{e.removeEventListener("success",a),e.removeEventListener("error",s)},a=()=>{n(h(e.result)),r()},s=()=>{o(e.error),r()};e.addEventListener("success",a),e.addEventListener("error",s)});return t.then(n=>{n instanceof IDBCursor&&W.set(n,e)}).catch(()=>{}),L.set(t,e),t}function Ke(e){if(T.has(e))return;const t=new Promise((n,o)=>{const r=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",s),e.removeEventListener("abort",s)},a=()=>{n(),r()},s=()=>{o(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",a),e.addEventListener("error",s),e.addEventListener("abort",s)});T.set(e,t)}let V={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return T.get(e);if(t==="objectStoreNames")return e.objectStoreNames||z.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return h(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function We(e){V=e(V)}function ze(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const o=e.call(C(this),t,...n);return z.set(o,t.sort?t.sort():[t]),h(o)}:$e().includes(e)?function(...t){return e.apply(C(this),t),h(W.get(this))}:function(...t){return h(e.apply(C(this),t))}}function He(e){return typeof e=="function"?ze(e):(e instanceof IDBTransaction&&Ke(e),Ae(e,Ne())?new Proxy(e,V):e)}function h(e){if(e instanceof IDBRequest)return Pe(e);if(B.has(e))return B.get(e);const t=He(e);return t!==e&&(B.set(e,t),L.set(t,e)),t}const C=e=>L.get(e);function Ge(e,t,{blocked:n,upgrade:o,blocking:r,terminated:a}={}){const s=indexedDB.open(e,t),d=h(s);return o&&s.addEventListener("upgradeneeded",c=>{o(h(s.result),c.oldVersion,c.newVersion,h(s.transaction),c)}),n&&s.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),d.then(c=>{a&&c.addEventListener("close",()=>a()),r&&c.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),d}const Je=["get","getKey","getAll","getAllKeys","count"],Qe=["put","add","delete","clear"],M=new Map;function N(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(M.get(t))return M.get(t);const n=t.replace(/FromIndex$/,""),o=t!==n,r=Qe.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!(r||Je.includes(n)))return;const a=async function(s,...d){const c=this.transaction(s,r?"readwrite":"readonly");let u=c.store;return o&&(u=u.index(d.shift())),(await Promise.all([u[n](...d),r&&c.done]))[0]};return M.set(t,a),a}We(e=>({...e,get:(t,n,o)=>N(t,n)||e.get(t,n,o),has:(t,n)=>!!N(t,n)||e.has(t,n)}));const Xe="charts-",_="folder",Ye=Xe+_,Ze=1,w=Ge(Ye,Ze,{upgrade(e){e.createObjectStore(_)}}),qe=ae("Folder",{state:()=>({list:[]}),actions:{async update(){const e=await(await w).getAllKeys(_),t=await Promise.all(e.map(n=>this.get(n)));this.list=(t||[]).sort((n,o)=>n.updatedTime-o.updatedTime)},async get(e){return await(await w).get(_,e)},async set(e,t){await(await w).put(_,t,e)&&this.update()},async del(e){await(await w).delete(_,e),this.update()},async clear(){return(await w).clear(_)},async keys(){return(await w).getAllKeys(_)}}}),et={class:"home"},tt={class:"wrapper"},nt=k({__name:"home",setup(e){const t=qe(),n=ce(()=>t.list),o=()=>{const s={id:Ue(),name:"未命名文件夹",createdTime:new Date().getTime(),updatedTime:new Date().getTime()};n.value.unshift({...s,isEdit:!0}),t.set(s.id,s)},r=s=>{const d=n.value.find(c=>c.id===s.id);d.name=s.name,d.updatedTime=new Date().getTime(),t.set(s.id,d),O({message:"保存成功",type:"success"})},a=s=>{ue.confirm("确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{t.del(s.id),O({type:"success",message:"删除成功"})})};return K.on("createFolder",()=>{o()}),$(()=>{t.update()}),(s,d)=>{const c=g("el-empty");return m(),I("div",et,[f(v(ve)),l("div",tt,[(m(!0),I(ie,null,de(v(n),u=>(m(),S(v(Le),{key:u.id,folder:u,onChange:r,onDel:a},null,8,["folder"]))),128)),v(n).length?le("",!0):(m(),S(c,{key:0,description:"没有数据","image-size":200}))])])}}});const st=P(nt,[["__scopeId","data-v-35f4f77a"]]);export{st as default};
