import{e as W,_ as de,g as re,P as ne,D as ue,a as _e,u as se,b as me,F as z}from"./index-ad9ed566.js";import{d as K,u as ae,c as $,r as y,o as s,a as u,b as o,e as h,w as f,f as g,g as T,h as H,i as X,j as d,k as B,l as Y,C as le,m as S,n as ce,t as A,p as P,q as Z,s as ee,_ as G,v as U,F as j,x as pe,y as L,z as he,E as te,A as oe}from"./index-237259ef.js";const fe={class:"topbar"},ve={class:"logo",title:"charts"},we=o("img",{src:de,alt:"charts"},null,-1),ye={class:"right"},ge=o("i",{class:"iconfont icon-jia"},null,-1),Ce=K({__name:"topbar",setup(e){const a=ae(),n=$(()=>a.params.type);$(()=>n.value==="folder"),y("");const c=()=>{W.emit("createChart","")};return(t,_)=>{const m=g("router-link"),p=g("el-button");return s(),u("div",fe,[o("h1",ve,[h(m,{tag:"a",to:{name:"home"}},{default:f(()=>[we,T(" Charts ")]),_:1})]),o("div",ye,[h(p,{size:"large",onClick:c},{default:f(()=>[ge,T("新建图表 ")]),_:1})])])}}});const J=e=>(Z("data-v-0fc7734e"),e=e(),ee(),e),ke={class:"folder-box"},be=["onClick"],Te=["src"],xe=J(()=>o("div",{class:"operation"},[o("i",{class:"iconfont icon-gengduo"})],-1)),$e=J(()=>o("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Ie=J(()=>o("i",{class:"iconfont icon-shanchu"},null,-1)),De={class:"name"},Se=J(()=>o("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Fe=K({__name:"folder",props:{folder:{type:Object,default:()=>({})},editId:{type:Number,default:null}},emits:["change","del"],setup(e,{emit:a}){const n=e,c=H(),t=y("未命名文件夹"),_=y(""),m=y(!1),p=y(null),k=()=>{m.value=!0,b()},b=()=>{P(()=>{var r;(r=p.value)==null||r.select()})},x=()=>{c.push({name:"home",params:{type:"folder",id:n.folder.id}})},v=()=>{t.value||(t.value=_.value),m.value=!1,a("change",{...n.folder,name:t.value})},C=()=>{v()},I=r=>{r==="del"&&a("del",n.folder),r==="edit"&&P(()=>{k()})},E=()=>{v()};return X(()=>{t.value=n.folder.name,_.value=n.folder.name,n.folder.id===n.editId&&k()}),(r,i)=>{const D=g("el-dropdown-item"),V=g("el-dropdown-menu"),N=g("el-dropdown"),O=g("el-input");return s(),u("div",ke,[o("div",{class:"content",onClick:B(x,["stop"])},[o("img",{src:d(re)("folder-big.svg")},null,8,Te),h(N,{teleported:!1,onCommand:I},{dropdown:f(()=>[h(V,null,{default:f(()=>[h(D,{command:"edit",onClick:i[0]||(i[0]=B(()=>{},["stop"]))},{default:f(()=>[$e,T(" 编辑 ")]),_:1}),h(D,{command:"del",onClick:i[1]||(i[1]=B(()=>{},["stop"]))},{default:f(()=>[Ie,T(" 删除 ")]),_:1})]),_:1})]),default:f(()=>[xe]),_:1})],8,be),o("div",De,[m.value?Y((s(),S(O,{key:0,ref_key:"inputRef",ref:p,modelValue:t.value,"onUpdate:modelValue":i[2]||(i[2]=R=>t.value=R),modelModifiers:{trim:!0},onKeydown:ce(C,["enter"])},null,8,["modelValue","onKeydown"])),[[d(le),E]]):(s(),u("div",{key:1,class:"text",onClick:k},[T(A(t.value)+" ",1),Se]))])])}}});const Be=G(Fe,[["__scopeId","data-v-0fc7734e"]]),Q=e=>(Z("data-v-2f918797"),e=e(),ee(),e),Ee={class:"chart-box"},Ve=Q(()=>o("i",{class:"iconfont icon-gengduo"},null,-1)),Ne=[Ve],Oe=Q(()=>o("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Re=Q(()=>o("i",{class:"iconfont icon-shanchu"},null,-1)),Me={class:"name"},je=Q(()=>o("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Ae=K({__name:"chartItem",props:{chart:{type:Object,default:()=>({})},editId:{type:Number,default:null}},emits:["change","del"],setup(e,{emit:a}){const n=e,c=H(),t=y(""),_=y(""),m=y(!1),p=y(null),k=()=>{m.value=!0,b()},b=()=>{P(()=>{var r;(r=p.value)==null||r.select()})},x=()=>{c.push({name:"chart",params:{id:n.chart.id}})},v=()=>{t.value||(t.value=_.value),m.value=!1,a("change",{...n.chart,name:t.value})},C=()=>{v()},I=r=>{r==="del"&&a("del",n.chart),r==="edit"&&P(()=>{k()})},E=()=>{v()};return X(()=>{t.value=n.chart.name}),(r,i)=>{const D=g("el-dropdown-item"),V=g("el-dropdown-menu"),N=g("el-dropdown"),O=g("el-input");return s(),u("div",Ee,[o("div",{class:"content",onClick:x},[h(d(ne),{chart:e.chart},null,8,["chart"]),h(N,{teleported:!1,onCommand:I},{dropdown:f(()=>[h(V,null,{default:f(()=>[h(D,{command:"edit",onClick:i[1]||(i[1]=B(()=>{},["stop"]))},{default:f(()=>[Oe,T(" 编辑 ")]),_:1}),h(D,{command:"del",onClick:i[2]||(i[2]=B(()=>{},["stop"]))},{default:f(()=>[Re,T(" 删除 ")]),_:1})]),_:1})]),default:f(()=>[o("div",{class:"operation",onClick:i[0]||(i[0]=B(()=>{},["stop"]))},Ne)]),_:1})]),o("div",Me,[m.value?Y((s(),S(O,{key:0,ref_key:"inputRef",ref:p,modelValue:t.value,"onUpdate:modelValue":i[3]||(i[3]=R=>t.value=R),modelModifiers:{trim:!0},onKeydown:ce(C,["enter"])},null,8,["modelValue","onKeydown"])),[[d(le),E]]):(s(),u("div",{key:1,class:"text",onClick:k},[o("span",null,A(t.value),1),T(),je]))])])}}});const Ke=G(Ae,[["__scopeId","data-v-2f918797"]]);function ze(e){const a=e.value;return{data:ue[a],theme:"westeros",legend:!0,title:{show:!0,value:e.label},animation:{intervalTime:1,moveTime:.5,startDelayTime:0,endDelayTime:1,loop:0}}}const Le={class:"container"},qe={class:"chart-wrapper"},Pe=["onClick"],Ue={class:"preview"},He={class:"name-box"},Ge=K({__name:"chartTemplate",emits:["close"],setup(e,{emit:a}){const n=H(),c=y(_e()),t=se(),_=()=>{a("close")},m=async p=>{const k={name:p.label,createdTime:new Date().getTime(),updatedTime:new Date().getTime(),type:p.value,config:ze(p)},b=await t.set(k);n.push({name:"chart",params:{id:b}}),_()};return(p,k)=>{const b=g("el-divider"),x=g("el-dialog");return s(),S(x,{fullscreen:!0,"model-value":!0,title:"图表模版","before-close":_},{default:f(()=>[o("div",Le,[(s(!0),u(j,null,U(c.value,v=>(s(),u("div",{key:v.value},[h(b,{"content-position":"left"},{default:f(()=>[T(A(v.label),1)]),_:2},1024),o("div",qe,[(s(!0),u(j,null,U(v.children,C=>(s(),u("div",{key:C.value,class:"chart-block",onClick:I=>m(C)},[o("div",Ue,[h(d(ne),{chart:C},null,8,["chart"])]),o("div",He,A(C.label),1)],8,Pe))),128))])]))),128))])]),_:1})}}});const Je=G(Ge,[["__scopeId","data-v-1a288ab1"]]),q=me(),Qe=pe("Folder",{state:()=>({list:[]}),actions:{async update(){const e=await(await q).getAllFromIndex(z,"id");this.list=(e||[]).sort((a,n)=>n.updatedTime-a.updatedTime)},async get(e){return await(await q).get(z,e)},async set(e){const a=(await q).transaction(z,"readwrite");if(e.id){const n=a.store.index("id");for await(const c of n.iterate(e.id)){const t=Object.assign(c.value,e);c.update(t)}return await a.done,e.id}else{const n=await a.store.add(e);return this.update(),await a.done,n}},async del(e){await(await q).delete(z,e),this.update()}}}),We=e=>(Z("data-v-7073530b"),e=e(),ee(),e),Xe={class:"home"},Ye={class:"wrapper"},Ze=We(()=>o("i",{class:"iconfont icon-fanhui"},null,-1)),et={class:"container"},tt=K({__name:"home",setup(e){const a=ae(),n=H(),c=Qe(),t=se(),_=$(()=>c.list),m=$(()=>t.list),p=$(()=>a.params.type),k=$(()=>+a.params.id),b=$(()=>p.value==="folder"),x=y(!0),v=y(null),C=y(!1),I=$(()=>_.value.find(l=>l.id===k.value)),E=async()=>{const l={name:"未命名文件夹",createdTime:new Date().getTime(),updatedTime:new Date().getTime()},w=await c.set(l);v.value=w,setTimeout(()=>{v.value=""},100)},r=()=>{n.push({name:"home"})},i=l=>{const w=_.value.find(M=>M.id===l.id);w.name=l.name,w.updatedTime=new Date().getTime(),c.set(w)},D=l=>{const w=_.value.find(M=>M.id===l.id);w.name=l.name,w.updatedTime=new Date().getTime(),t.set(w)},V=l=>{te.confirm("确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{c.del(l.id),oe({type:"success",message:"删除成功"})})},N=l=>{te.confirm("确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{t.del(l.id),oe({type:"success",message:"删除成功"})})},O=()=>{C.value=!0};W.on("createFolder",()=>{E()}),W.on("createChart",()=>{O()});const R=()=>{const l=new BroadcastChannel("chart");l.onmessage=async w=>{await c.update(),await t.update()}};return X(async()=>{var l;(l=document.querySelector("html"))==null||l.classList.remove("dark"),await c.update(),await t.update(),x.value=!1,R()}),(l,w)=>{const M=g("el-empty"),ie=he("loading");return s(),u("div",Xe,[h(d(Ce)),Y((s(),u("div",Ye,[d(b)&&d(I)?(s(),u("div",{key:0,class:"back",onClick:r},[Ze,T(" "+A(d(I).name),1)])):L("",!0),o("div",et,[d(b)?L("",!0):(s(),u(j,{key:0},[(s(!0),u(j,null,U(d(_),F=>(s(),S(d(Be),{key:F.id,editId:v.value,folder:F,onChange:i,onDel:V},null,8,["editId","folder"]))),128)),(s(!0),u(j,null,U(d(m),F=>(s(),S(d(Ke),{key:F.id,chart:F,onChange:D,onDel:N},null,8,["chart"]))),128))],64))]),!d(_).length&&!d(m).length&&!x.value?(s(),S(M,{key:1,description:"当前内容为空","image-size":200})):L("",!0),C.value?(s(),S(d(Je),{key:2,onClose:w[0]||(w[0]=F=>C.value=!1)})):L("",!0)])),[[ie,x.value]])])}}});const st=G(tt,[["__scopeId","data-v-7073530b"]]);export{st as default};
