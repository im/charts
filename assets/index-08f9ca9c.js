import{D as _e,u as Y,g as ae,P as Z,_ as pe,a as me,b as he,F as z,e as oe,c as fe}from"./lodash-0e59a2cd.js";import{d as j,u as le,c as $,r as T,a as G,o as s,b as v,e as t,f as y,w,g as b,h as x,F as M,i as U,t as F,j as i,p as J,k as Q,_ as A,l as ee,m as E,n as te,C as ce,q as S,s as de,v as H,x as ve,y as q,z as ye,E as ne,A as se}from"./index-6d2b136f.js";function ie(e){const a=e.value;return{data:_e[a],theme:"westeros",legend:!0,backgroundColor:"#ffffff",title:{show:!0,value:e.label,color:"#333333"},animation:{intervalTime:1,moveTime:.5,startDelayTime:0,endDelayTime:1,loop:0}}}const re=e=>(J("data-v-7dcc22ba"),e=e(),Q(),e),we={class:"topbar"},ge={class:"logo",title:"charts"},Ce=re(()=>t("img",{src:pe,alt:"charts"},null,-1)),be={class:"right"},ke={class:"chart-list"},Te=["onClick"],$e={class:"tag"},xe={class:"preview"},Ie={class:"name-box"},De=re(()=>t("i",{class:"iconfont icon-jia"},null,-1)),Se=j({__name:"topbar",setup(e){const a=le(),n=$(()=>a.params.type);$(()=>n.value==="folder"),T("");const _=Y(),o=G(),g=$(()=>ae().reduce((c,d)=>{const m=(d.children||[]).map(h=>({...h,parentLabel:d.label}));return c=c.concat(m),c},[])),r=async l=>{const c={name:l.label,createdTime:new Date().getTime(),updatedTime:new Date().getTime(),type:l.value,config:ie(l)},d=await _.set(c);o.push({name:"chart",params:{id:d}})};return(l,c)=>{const d=b("router-link"),C=b("el-button"),m=b("el-popover");return s(),v("div",we,[t("h1",ge,[y(d,{tag:"a",to:{name:"home"}},{default:w(()=>[Ce,x(" Charts ")]),_:1})]),t("div",be,[y(m,{placement:"bottom",width:700,trigger:"click",content:""},{reference:w(()=>[y(C,{size:"large"},{default:w(()=>[De,x("新建图表 ")]),_:1})]),default:w(()=>[t("div",ke,[(s(!0),v(M,null,U(i(g),h=>(s(),v("div",{key:h.value,class:"chart-block",onClick:I=>r(h)},[t("div",$e,F(h.parentLabel),1),t("div",xe,[y(i(Z),{chart:h},null,8,["chart"])]),t("div",Ie,F(h.label),1)],8,Te))),128))])]),_:1})])])}}});const Fe=A(Se,[["__scopeId","data-v-7dcc22ba"]]),W=e=>(J("data-v-0fc7734e"),e=e(),Q(),e),Be={class:"folder-box"},Ee=["onClick"],Ve=["src"],Ne=W(()=>t("div",{class:"operation"},[t("i",{class:"iconfont icon-gengduo"})],-1)),Oe=W(()=>t("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Re=W(()=>t("i",{class:"iconfont icon-shanchu"},null,-1)),Le={class:"name"},Me=W(()=>t("i",{class:"iconfont icon-weibiaoti520"},null,-1)),je=j({__name:"folder",props:{folder:{type:Object,default:()=>({})},editId:{type:Number,default:null}},emits:["change","del"],setup(e,{emit:a}){const n=e,_=G(),o=T("未命名文件夹"),g=T(""),r=T(!1),l=T(null),c=()=>{r.value=!0,d()},d=()=>{H(()=>{var f;(f=l.value)==null||f.select()})},C=()=>{_.push({name:"home",params:{type:"folder",id:n.folder.id}})},m=()=>{o.value||(o.value=g.value),r.value=!1,a("change",{...n.folder,name:o.value})},h=()=>{m()},I=f=>{f==="del"&&a("del",n.folder),f==="edit"&&H(()=>{c()})},V=()=>{m()};return ee(()=>{o.value=n.folder.name,g.value=n.folder.name,n.folder.id===n.editId&&c()}),(f,p)=>{const D=b("el-dropdown-item"),N=b("el-dropdown-menu"),O=b("el-dropdown"),R=b("el-input");return s(),v("div",Be,[t("div",{class:"content",onClick:E(C,["stop"])},[t("img",{src:i(me)("folder-big.svg")},null,8,Ve),y(O,{teleported:!1,onCommand:I},{dropdown:w(()=>[y(N,null,{default:w(()=>[y(D,{command:"edit",onClick:p[0]||(p[0]=E(()=>{},["stop"]))},{default:w(()=>[Oe,x(" 编辑 ")]),_:1}),y(D,{command:"del",onClick:p[1]||(p[1]=E(()=>{},["stop"]))},{default:w(()=>[Re,x(" 删除 ")]),_:1})]),_:1})]),default:w(()=>[Ne]),_:1})],8,Ee),t("div",Le,[r.value?te((s(),S(R,{key:0,ref_key:"inputRef",ref:l,modelValue:o.value,"onUpdate:modelValue":p[2]||(p[2]=L=>o.value=L),modelModifiers:{trim:!0},onKeydown:de(h,["enter"])},null,8,["modelValue","onKeydown"])),[[i(ce),V]]):(s(),v("div",{key:1,class:"text",onClick:c},[x(F(o.value)+" ",1),Me]))])])}}});const Ae=A(je,[["__scopeId","data-v-0fc7734e"]]),K=e=>(J("data-v-5fda0373"),e=e(),Q(),e),Ke={class:"chart-box"},ze=K(()=>t("i",{class:"iconfont icon-gengduo"},null,-1)),qe=[ze],Pe=K(()=>t("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Ue=K(()=>t("i",{class:"iconfont icon-shanchu"},null,-1)),He=K(()=>t("div",{class:"edit-box"},[t("span",null,"编辑")],-1)),Ge={class:"name"},Je=K(()=>t("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Qe=j({__name:"chartItem",props:{chart:{type:Object,default:()=>({})},editId:{type:Number,default:null}},emits:["change","del"],setup(e,{emit:a}){const n=e,_=G(),o=T(""),g=T(""),r=T(!1),l=T(null),c=()=>{r.value=!0,d()},d=()=>{H(()=>{var f;(f=l.value)==null||f.select()})},C=()=>{_.push({name:"chart",params:{id:n.chart.id}})},m=()=>{o.value||(o.value=g.value),r.value=!1,a("change",{...n.chart,name:o.value})},h=()=>{m()},I=f=>{f==="del"&&a("del",n.chart),f==="edit"&&H(()=>{c()})},V=()=>{m()};return ee(()=>{o.value=n.chart.name}),(f,p)=>{const D=b("el-dropdown-item"),N=b("el-dropdown-menu"),O=b("el-dropdown"),R=b("el-input");return s(),v("div",Ke,[t("div",{class:"content",onClick:C},[y(i(Z),{chart:e.chart},null,8,["chart"]),y(O,{teleported:!1,onCommand:I},{dropdown:w(()=>[y(N,null,{default:w(()=>[y(D,{command:"edit",onClick:p[1]||(p[1]=E(()=>{},["stop"]))},{default:w(()=>[Pe,x(" 编辑 ")]),_:1}),y(D,{command:"del",onClick:p[2]||(p[2]=E(()=>{},["stop"]))},{default:w(()=>[Ue,x(" 删除 ")]),_:1})]),_:1})]),default:w(()=>[t("div",{class:"operation",onClick:p[0]||(p[0]=E(()=>{},["stop"]))},qe)]),_:1}),He]),t("div",Ge,[r.value?te((s(),S(R,{key:0,ref_key:"inputRef",ref:l,modelValue:o.value,"onUpdate:modelValue":p[3]||(p[3]=L=>o.value=L),modelModifiers:{trim:!0},onKeydown:de(h,["enter"])},null,8,["modelValue","onKeydown"])),[[i(ce),V]]):(s(),v("div",{key:1,class:"text",onClick:c},[t("span",null,F(o.value),1),x(),Je]))])])}}});const We=A(Qe,[["__scopeId","data-v-5fda0373"]]),Xe={class:"container"},Ye=["onClick"],Ze={class:"tag"},et={class:"preview"},tt={class:"name-box"},ot=j({__name:"chartTemplate",emits:["close"],setup(e,{emit:a}){const n=$(()=>ae().reduce((l,c)=>{const C=(c.children||[]).map(m=>({...m,parentLabel:c.label}));return l=l.concat(C),l},[])),_=Y(),o=()=>{a("close")},g=async r=>{const l={name:r.label,createdTime:new Date().getTime(),updatedTime:new Date().getTime(),type:r.value,config:ie(r)};await _.set(l),o()};return(r,l)=>{const c=b("el-dialog");return s(),S(c,{fullscreen:!0,"model-value":!0,title:"图表模版","before-close":o},{default:w(()=>[t("div",Xe,[(s(!0),v(M,null,U(i(n),d=>(s(),v("div",{key:d.value,class:"chart-wrapper",onClick:C=>g(d)},[t("div",Ze,F(d.parentLabel),1),t("div",et,[y(i(Z),{chart:d},null,8,["chart"])]),t("div",tt,F(d.label),1)],8,Ye))),128))])]),_:1})}}});const nt=A(ot,[["__scopeId","data-v-f4752d19"]]),P=he(),st=ve("Folder",{state:()=>({list:[]}),actions:{async update(){const e=await(await P).getAllFromIndex(z,"id");this.list=(e||[]).sort((a,n)=>n.updatedTime-a.updatedTime)},async get(e){return await(await P).get(z,e)},async set(e){const a=(await P).transaction(z,"readwrite");if(e.id){const n=a.store.index("id");for await(const _ of n.iterate(e.id)){const o=Object.assign(_.value,e);_.update(o)}return await a.done,e.id}else{const n=await a.store.add(e);return this.update(),await a.done,n}},async del(e){await(await P).delete(z,e),this.update()}}}),at=e=>(J("data-v-d71d908c"),e=e(),Q(),e),lt={class:"home"},ct={class:"wrapper"},dt=at(()=>t("i",{class:"iconfont icon-fanhui"},null,-1)),it={class:"container"},rt=j({__name:"home",setup(e){const a=le(),n=G(),_=st(),o=Y(),g=$(()=>_.list),r=$(()=>o.list),l=$(()=>a.params.type),c=$(()=>+a.params.id),d=$(()=>l.value==="folder"),C=T(!0),m=T(null),h=T(!1),I=$(()=>g.value.find(u=>u.id===c.value)),V=async()=>{const u={name:"未命名文件夹",createdTime:new Date().getTime(),updatedTime:new Date().getTime()},k=await _.set(u);m.value=k,setTimeout(()=>{m.value=""},100)},f=()=>{n.push({name:"home"})},p=u=>{const k=g.value.find(X=>X.id===u.id);k.name=u.name,k.updatedTime=new Date().getTime(),_.set(k)},D=u=>{const k=fe.cloneDeep(u);k.updatedTime=new Date().getTime(),o.set(k)},N=u=>{ne.confirm("确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{_.del(u.id),se({type:"success",message:"删除成功"})})},O=u=>{ne.confirm("确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{o.del(u.id),se({type:"success",message:"删除成功"})})},R=()=>{h.value=!0};oe.on("createFolder",()=>{V()}),oe.on("createChart",()=>{R()});const L=()=>{const u=new BroadcastChannel("chart");u.onmessage=async k=>{await _.update(),await o.update()}};return ee(async()=>{var u;(u=document.querySelector("html"))==null||u.classList.remove("dark"),await _.update(),await o.update(),C.value=!1,L()}),(u,k)=>{const X=b("el-empty"),ue=ye("loading");return s(),v("div",lt,[y(i(Fe)),te((s(),v("div",ct,[i(d)&&i(I)?(s(),v("div",{key:0,class:"back",onClick:f},[dt,x(" "+F(i(I).name),1)])):q("",!0),t("div",it,[i(d)?q("",!0):(s(),v(M,{key:0},[(s(!0),v(M,null,U(i(g),B=>(s(),S(i(Ae),{key:B.id,editId:m.value,folder:B,onChange:p,onDel:N},null,8,["editId","folder"]))),128)),(s(!0),v(M,null,U(i(r),B=>(s(),S(i(We),{key:B.id,chart:B,onChange:D,onDel:O},null,8,["chart"]))),128))],64))]),!i(g).length&&!i(r).length&&!C.value?(s(),S(X,{key:1,description:"当前内容为空","image-size":200})):q("",!0),h.value?(s(),S(i(nt),{key:2,onClose:k[0]||(k[0]=B=>h.value=!1)})):q("",!0)])),[[ue,C.value]])])}}});const pt=A(rt,[["__scopeId","data-v-d71d908c"]]);export{pt as default};
