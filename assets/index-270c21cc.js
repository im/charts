import{d as z,c as F,r as C,o as l,a as m,b as a,e as h,w as _,u as r,f as D,g as M,h as w,i as $,j as oe,k as Q,l as W,C as ne,m as se,t as j,n as U,p as X,q as Y,s as q,_ as H,v as Z,x as L,F as R,y as ie,z as de,E as ee,A as te}from"./index-20656487.js";import{g as re,P as ae,a as ue,u as le,D as _e,F as K}from"./chart-2457dae4.js";const pe="/charts/logo.svg";function me(e){return{all:e=e||new Map,on:function(n,t){var s=e.get(n);s?s.push(t):e.set(n,[t])},off:function(n,t){var s=e.get(n);s&&(t?s.splice(s.indexOf(t)>>>0,1):e.set(n,[]))},emit:function(n,t){var s=e.get(n);s&&s.slice().map(function(o){o(t)}),(s=e.get("*"))&&s.slice().map(function(o){o(n,t)})}}}const P=me(),he={class:"topbar"},fe={class:"logo",title:"charts"},ve=a("img",{src:pe,alt:"charts"},null,-1),we={class:"right"},ge=a("i",{class:"iconfont icon-jia"},null,-1),ye=a("i",{class:"iconfont icon-jia"},null,-1),Ce=a("i",{class:"iconfont icon-search-2-copy"},null,-1),ke=z({__name:"topbar",setup(e){const n=oe(),t=F(()=>n.params.type),s=F(()=>t.value==="folder"),o=C(""),p=()=>{P.emit("createFolder","")},g=()=>{P.emit("createChart","")};return(k,f)=>{const b=w("router-link"),v=w("el-button"),i=w("el-input");return l(),m("div",he,[a("h1",fe,[h(b,{tag:"a",to:{name:"home"}},{default:_(()=>[ve,$(" Charts ")]),_:1})]),a("div",we,[h(v,{size:"large",onClick:g},{default:_(()=>[ge,$("新建图表 ")]),_:1}),r(s)?M("",!0):(l(),D(v,{key:0,size:"large",onClick:p},{default:_(()=>[ye,$("新建文件夹 ")]),_:1})),h(i,{modelValue:o.value,"onUpdate:modelValue":f[0]||(f[0]=u=>o.value=u),size:"large",class:"search",placeholder:"在当前页面搜索"},{prefix:_(()=>[Ce]),_:1},8,["modelValue"])])])}}});const G=e=>(X("data-v-a1d9559d"),e=e(),Y(),e),be={class:"folder-box"},xe=["src"],$e=G(()=>a("div",{class:"operation"},[a("i",{class:"iconfont icon-gengduo"})],-1)),Te=G(()=>a("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Ie=G(()=>a("i",{class:"iconfont icon-shanchu"},null,-1)),Fe={class:"name"},De=G(()=>a("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Se=z({__name:"folder",props:{folder:{type:Object,default:()=>({})},editId:{type:Number,default:null}},emits:["change","del"],setup(e,{emit:n}){const t=e,s=q(),o=C("未命名文件夹"),p=C(""),g=C(!1),k=C(null),f=()=>{g.value=!0,b()},b=()=>{U(()=>{var d;(d=k.value)==null||d.select()})},v=()=>{s.push({name:"home",params:{type:"folder",id:t.folder.id}})},i=()=>{o.value||(o.value=p.value),g.value=!1,n("change",{...t.folder,name:o.value})},u=()=>{i()},T=d=>{d==="del"&&n("del",t.folder),d==="edit"&&U(()=>{f()})},E=()=>{i()};return Q(()=>{o.value=t.folder.name,p.value=t.folder.name,t.folder.id===t.editId&&f()}),(d,y)=>{const I=w("el-dropdown-item"),S=w("el-dropdown-menu"),B=w("el-dropdown"),N=w("el-input");return l(),m("div",be,[a("div",{class:"content",onClick:v},[a("img",{src:r(re)("folder-big.svg")},null,8,xe),h(B,{teleported:!1,onCommand:T},{dropdown:_(()=>[h(S,null,{default:_(()=>[h(I,{command:"edit"},{default:_(()=>[Te,$(" 编辑 ")]),_:1}),h(I,{command:"del"},{default:_(()=>[Ie,$(" 删除 ")]),_:1})]),_:1})]),default:_(()=>[$e]),_:1})]),a("div",Fe,[g.value?W((l(),D(N,{key:0,ref_key:"inputRef",ref:k,modelValue:o.value,"onUpdate:modelValue":y[0]||(y[0]=c=>o.value=c),modelModifiers:{trim:!0},onKeydown:se(u,["enter"])},null,8,["modelValue","onKeydown"])),[[r(ne),E]]):(l(),m("div",{key:1,class:"text",onClick:f},[$(j(o.value)+" ",1),De]))])])}}});const Ve=H(Se,[["__scopeId","data-v-a1d9559d"]]),J=e=>(X("data-v-436a253b"),e=e(),Y(),e),Ee={class:"chart-box"},Be=J(()=>a("div",{class:"operation"},[a("i",{class:"iconfont icon-gengduo"})],-1)),Ne=J(()=>a("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Oe=J(()=>a("i",{class:"iconfont icon-shanchu"},null,-1)),Me={class:"name"},Re=J(()=>a("i",{class:"iconfont icon-weibiaoti520"},null,-1)),je=z({__name:"chartItem",props:{chart:{type:Object,default:()=>({})},editId:{type:Number,default:null}},emits:["change","del"],setup(e,{emit:n}){const t=e,s=q(),o=C(""),p=C(""),g=C(!1),k=C(null),f=()=>{g.value=!0,b()},b=()=>{U(()=>{var d;(d=k.value)==null||d.select()})},v=()=>{const{href:d}=s.resolve({name:"chart",params:{id:t.chart.id}}),{origin:y,pathname:I}=window.location,S=y+I+d;window.open(S,"_blank")},i=()=>{o.value||(o.value=p.value),g.value=!1,n("change",{...t.chart,name:o.value})},u=()=>{i()},T=d=>{d==="del"&&n("del",t.chart),d==="edit"&&U(()=>{f()})},E=()=>{i()};return Q(()=>{o.value=t.chart.name}),(d,y)=>{const I=w("el-dropdown-item"),S=w("el-dropdown-menu"),B=w("el-dropdown"),N=w("el-input");return l(),m("div",Ee,[a("div",{class:"content",onClick:v},[h(r(ae),{chart:e.chart},null,8,["chart"]),h(B,{teleported:!1,onCommand:T},{dropdown:_(()=>[h(S,null,{default:_(()=>[h(I,{command:"edit",onClick:y[0]||(y[0]=Z(()=>{},["stop"]))},{default:_(()=>[Ne,$(" 编辑 ")]),_:1}),h(I,{command:"del",onClick:y[1]||(y[1]=Z(()=>{},["stop"]))},{default:_(()=>[Oe,$(" 删除 ")]),_:1})]),_:1})]),default:_(()=>[Be]),_:1})]),a("div",Me,[g.value?W((l(),D(N,{key:0,ref_key:"inputRef",ref:k,modelValue:o.value,"onUpdate:modelValue":y[2]||(y[2]=c=>o.value=c),modelModifiers:{trim:!0},onKeydown:se(u,["enter"])},null,8,["modelValue","onKeydown"])),[[r(ne),E]]):(l(),m("div",{key:1,class:"text",onClick:f},[a("span",null,j(o.value),1),$(),Re]))])])}}});const ze=H(je,[["__scopeId","data-v-436a253b"]]),Ke={class:"container"},Ae={class:"chart-wrapper"},Ue=["onClick"],Le={class:"preview"},Pe={class:"name-box"},qe=z({__name:"chartTemplate",emits:["close"],setup(e,{emit:n}){const t=q(),s=C(ue()),o=le(),p=()=>{n("close")},g=async k=>{const f={name:k.label,createdTime:new Date().getTime(),updatedTime:new Date().getTime(),type:k.value},b=await o.set(f),{href:v}=t.resolve({name:"chart",params:{id:b}}),{origin:i,pathname:u}=window.location,T=i+u+v;window.open(T,"_blank"),p()};return(k,f)=>{const b=w("el-divider"),v=w("el-dialog");return l(),D(v,{fullscreen:!0,"model-value":!0,title:"图表模版","before-close":p},{default:_(()=>[a("div",Ke,[(l(!0),m(R,null,L(s.value,i=>(l(),m("div",{key:i.value},[h(b,{"content-position":"left"},{default:_(()=>[$(j(i.label),1)]),_:2},1024),a("div",Ae,[(l(!0),m(R,null,L(i.children,u=>(l(),m("div",{key:u.value,class:"chart-block",onClick:T=>g(u)},[a("div",Le,[h(r(ae),{chart:u},null,8,["chart"])]),a("div",Pe,j(u.label),1)],8,Ue))),128))])]))),128))])]),_:1})}}});const He=H(qe,[["__scopeId","data-v-8e9d9ed8"]]),A=_e(),Ge=ie("Folder",{state:()=>({list:[]}),actions:{async update(){const e=await(await A).getAllFromIndex(K,"id");this.list=(e||[]).sort((n,t)=>t.updatedTime-n.updatedTime)},async get(e){return await(await A).get(K,e)},async set(e){const n=(await A).transaction(K,"readwrite");if(e.id){const t=n.store.index("id");for await(const s of t.iterate(e.id)){const o=Object.assign(s.value,e);s.update(o)}return await n.done,e.id}else{const t=await n.store.add(e);return this.update(),await n.done,t}},async del(e){await(await A).delete(K,e),this.update()}}}),Je=e=>(X("data-v-eb6655d1"),e=e(),Y(),e),Qe={class:"home"},We={class:"wrapper"},Xe=Je(()=>a("i",{class:"iconfont icon-fanhui"},null,-1)),Ye={class:"container"},Ze=z({__name:"home",setup(e){const n=oe(),t=q(),s=Ge(),o=le(),p=F(()=>s.list),g=F(()=>o.list),k=F(()=>n.params.type),f=F(()=>+n.params.id),b=F(()=>k.value==="folder"),v=C(!0),i=C(null),u=C(!1),T=F(()=>p.value.find(c=>c.id===f.value)),E=async()=>{const c={name:"未命名文件夹",createdTime:new Date().getTime(),updatedTime:new Date().getTime()},x=await s.set(c);i.value=x,setTimeout(()=>{i.value=""},100)},d=()=>{t.push({name:"home"})},y=c=>{const x=p.value.find(O=>O.id===c.id);x.name=c.name,x.updatedTime=new Date().getTime(),s.set(x)},I=c=>{const x=p.value.find(O=>O.id===c.id);x.name=c.name,x.updatedTime=new Date().getTime(),o.set(x)},S=c=>{ee.confirm("确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{s.del(c.id),te({type:"success",message:"删除成功"})})},B=c=>{ee.confirm("确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{o.del(c.id),te({type:"success",message:"删除成功"})})},N=()=>{u.value=!0};return P.on("createFolder",()=>{E()}),P.on("createChart",()=>{N()}),Q(async()=>{await s.update(),await o.update(),v.value=!1}),(c,x)=>{const O=w("el-empty"),ce=de("loading");return l(),m("div",Qe,[h(r(ke)),W((l(),m("div",We,[r(b)&&r(T)?(l(),m("div",{key:0,class:"back",onClick:d},[Xe,$(" "+j(r(T).name),1)])):M("",!0),a("div",Ye,[r(b)?M("",!0):(l(),m(R,{key:0},[(l(!0),m(R,null,L(r(p),V=>(l(),D(r(Ve),{key:V.id,editId:i.value,folder:V,onChange:y,onDel:S},null,8,["editId","folder"]))),128)),(l(!0),m(R,null,L(r(g),V=>(l(),D(r(ze),{key:V.id,chart:V,onChange:I,onDel:B},null,8,["chart"]))),128))],64))]),!r(p).length&&!v.value?(l(),D(O,{key:1,description:"当前内容为空","image-size":200})):M("",!0),u.value?(l(),D(r(He),{key:2,onClose:x[0]||(x[0]=V=>u.value=!1)})):M("",!0)])),[[ce,v.value]])])}}});const ot=H(Ze,[["__scopeId","data-v-eb6655d1"]]);export{ot as default};
