import{e as U,g as de,P as oe,a as ie,u as ne,D as re,F as K}from"./chart-7a85c248.js";import{d as z,u as se,c as F,r as k,o as s,a as m,b as t,e as h,w as _,f as i,g as D,h as R,i as w,j as $,k as q,l as Q,m as W,C as ae,n as le,t as j,p as L,q as X,s as Y,_ as H,v as Z,x as P,F as M,y as ue,z as _e,E as ee,A as te}from"./index-744e9c01.js";const pe="/charts/logo.svg",me={class:"topbar"},he={class:"logo",title:"charts"},fe=t("img",{src:pe,alt:"charts"},null,-1),ve={class:"right"},we=t("i",{class:"iconfont icon-jia"},null,-1),ge=t("i",{class:"iconfont icon-jia"},null,-1),ye=t("i",{class:"iconfont icon-search-2-copy"},null,-1),Ce=z({__name:"topbar",setup(e){const a=se(),n=F(()=>a.params.type),r=F(()=>n.value==="folder"),o=k(""),p=()=>{U.emit("createFolder","")},g=()=>{U.emit("createChart","")};return(y,f)=>{const b=w("router-link"),v=w("el-button"),c=w("el-input");return s(),m("div",me,[t("h1",he,[h(b,{tag:"a",to:{name:"home"}},{default:_(()=>[fe,$(" Charts ")]),_:1})]),t("div",ve,[h(v,{size:"large",onClick:g},{default:_(()=>[we,$("新建图表 ")]),_:1}),i(r)?R("",!0):(s(),D(v,{key:0,size:"large",onClick:p},{default:_(()=>[ge,$("新建文件夹 ")]),_:1})),h(c,{modelValue:o.value,"onUpdate:modelValue":f[0]||(f[0]=u=>o.value=u),size:"large",class:"search",placeholder:"在当前页面搜索"},{prefix:_(()=>[ye]),_:1},8,["modelValue"])])])}}});const G=e=>(X("data-v-a1d9559d"),e=e(),Y(),e),ke={class:"folder-box"},be=["src"],xe=G(()=>t("div",{class:"operation"},[t("i",{class:"iconfont icon-gengduo"})],-1)),$e=G(()=>t("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Te=G(()=>t("i",{class:"iconfont icon-shanchu"},null,-1)),Ie={class:"name"},Fe=G(()=>t("i",{class:"iconfont icon-weibiaoti520"},null,-1)),De=z({__name:"folder",props:{folder:{type:Object,default:()=>({})},editId:{type:Number,default:null}},emits:["change","del"],setup(e,{emit:a}){const n=e,r=q(),o=k("未命名文件夹"),p=k(""),g=k(!1),y=k(null),f=()=>{g.value=!0,b()},b=()=>{L(()=>{var d;(d=y.value)==null||d.select()})},v=()=>{r.push({name:"home",params:{type:"folder",id:n.folder.id}})},c=()=>{o.value||(o.value=p.value),g.value=!1,a("change",{...n.folder,name:o.value})},u=()=>{c()},T=d=>{d==="del"&&a("del",n.folder),d==="edit"&&L(()=>{f()})},E=()=>{c()};return Q(()=>{o.value=n.folder.name,p.value=n.folder.name,n.folder.id===n.editId&&f()}),(d,C)=>{const I=w("el-dropdown-item"),S=w("el-dropdown-menu"),B=w("el-dropdown"),N=w("el-input");return s(),m("div",ke,[t("div",{class:"content",onClick:v},[t("img",{src:i(de)("folder-big.svg")},null,8,be),h(B,{teleported:!1,onCommand:T},{dropdown:_(()=>[h(S,null,{default:_(()=>[h(I,{command:"edit"},{default:_(()=>[$e,$(" 编辑 ")]),_:1}),h(I,{command:"del"},{default:_(()=>[Te,$(" 删除 ")]),_:1})]),_:1})]),default:_(()=>[xe]),_:1})]),t("div",Ie,[g.value?W((s(),D(N,{key:0,ref_key:"inputRef",ref:y,modelValue:o.value,"onUpdate:modelValue":C[0]||(C[0]=l=>o.value=l),modelModifiers:{trim:!0},onKeydown:le(u,["enter"])},null,8,["modelValue","onKeydown"])),[[i(ae),E]]):(s(),m("div",{key:1,class:"text",onClick:f},[$(j(o.value)+" ",1),Fe]))])])}}});const Se=H(De,[["__scopeId","data-v-a1d9559d"]]),J=e=>(X("data-v-436a253b"),e=e(),Y(),e),Ve={class:"chart-box"},Ee=J(()=>t("div",{class:"operation"},[t("i",{class:"iconfont icon-gengduo"})],-1)),Be=J(()=>t("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Ne=J(()=>t("i",{class:"iconfont icon-shanchu"},null,-1)),Oe={class:"name"},Re=J(()=>t("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Me=z({__name:"chartItem",props:{chart:{type:Object,default:()=>({})},editId:{type:Number,default:null}},emits:["change","del"],setup(e,{emit:a}){const n=e,r=q(),o=k(""),p=k(""),g=k(!1),y=k(null),f=()=>{g.value=!0,b()},b=()=>{L(()=>{var d;(d=y.value)==null||d.select()})},v=()=>{const{href:d}=r.resolve({name:"chart",params:{id:n.chart.id}}),{origin:C,pathname:I}=window.location,S=C+I+d;window.open(S,"_blank")},c=()=>{o.value||(o.value=p.value),g.value=!1,a("change",{...n.chart,name:o.value})},u=()=>{c()},T=d=>{d==="del"&&a("del",n.chart),d==="edit"&&L(()=>{f()})},E=()=>{c()};return Q(()=>{o.value=n.chart.name}),(d,C)=>{const I=w("el-dropdown-item"),S=w("el-dropdown-menu"),B=w("el-dropdown"),N=w("el-input");return s(),m("div",Ve,[t("div",{class:"content",onClick:v},[h(i(oe),{chart:e.chart},null,8,["chart"]),h(B,{teleported:!1,onCommand:T},{dropdown:_(()=>[h(S,null,{default:_(()=>[h(I,{command:"edit",onClick:C[0]||(C[0]=Z(()=>{},["stop"]))},{default:_(()=>[Be,$(" 编辑 ")]),_:1}),h(I,{command:"del",onClick:C[1]||(C[1]=Z(()=>{},["stop"]))},{default:_(()=>[Ne,$(" 删除 ")]),_:1})]),_:1})]),default:_(()=>[Ee]),_:1})]),t("div",Oe,[g.value?W((s(),D(N,{key:0,ref_key:"inputRef",ref:y,modelValue:o.value,"onUpdate:modelValue":C[2]||(C[2]=l=>o.value=l),modelModifiers:{trim:!0},onKeydown:le(u,["enter"])},null,8,["modelValue","onKeydown"])),[[i(ae),E]]):(s(),m("div",{key:1,class:"text",onClick:f},[t("span",null,j(o.value),1),$(),Re]))])])}}});const je=H(Me,[["__scopeId","data-v-436a253b"]]);function ze(e){console.log("chart: ",e)}const Ke={class:"container"},Ae={class:"chart-wrapper"},Ue=["onClick"],Le={class:"preview"},Pe={class:"name-box"},qe=z({__name:"chartTemplate",emits:["close"],setup(e,{emit:a}){const n=q(),r=k(ie()),o=ne(),p=()=>{a("close")},g=async y=>{const f={name:y.label,createdTime:new Date().getTime(),updatedTime:new Date().getTime(),type:y.value,option:ze(y)},b=await o.set(f),{href:v}=n.resolve({name:"chart",params:{id:b}}),{origin:c,pathname:u}=window.location,T=c+u+v;window.open(T,"_blank"),p()};return(y,f)=>{const b=w("el-divider"),v=w("el-dialog");return s(),D(v,{fullscreen:!0,"model-value":!0,title:"图表模版","before-close":p},{default:_(()=>[t("div",Ke,[(s(!0),m(M,null,P(r.value,c=>(s(),m("div",{key:c.value},[h(b,{"content-position":"left"},{default:_(()=>[$(j(c.label),1)]),_:2},1024),t("div",Ae,[(s(!0),m(M,null,P(c.children,u=>(s(),m("div",{key:u.value,class:"chart-block",onClick:T=>g(u)},[t("div",Le,[h(i(oe),{chart:u},null,8,["chart"])]),t("div",Pe,j(u.label),1)],8,Ue))),128))])]))),128))])]),_:1})}}});const He=H(qe,[["__scopeId","data-v-aecd4ea3"]]),A=re(),Ge=ue("Folder",{state:()=>({list:[]}),actions:{async update(){const e=await(await A).getAllFromIndex(K,"id");this.list=(e||[]).sort((a,n)=>n.updatedTime-a.updatedTime)},async get(e){return await(await A).get(K,e)},async set(e){const a=(await A).transaction(K,"readwrite");if(e.id){const n=a.store.index("id");for await(const r of n.iterate(e.id)){const o=Object.assign(r.value,e);r.update(o)}return await a.done,e.id}else{const n=await a.store.add(e);return this.update(),await a.done,n}},async del(e){await(await A).delete(K,e),this.update()}}}),Je=e=>(X("data-v-eb6655d1"),e=e(),Y(),e),Qe={class:"home"},We={class:"wrapper"},Xe=Je(()=>t("i",{class:"iconfont icon-fanhui"},null,-1)),Ye={class:"container"},Ze=z({__name:"home",setup(e){const a=se(),n=q(),r=Ge(),o=ne(),p=F(()=>r.list),g=F(()=>o.list),y=F(()=>a.params.type),f=F(()=>+a.params.id),b=F(()=>y.value==="folder"),v=k(!0),c=k(null),u=k(!1),T=F(()=>p.value.find(l=>l.id===f.value)),E=async()=>{const l={name:"未命名文件夹",createdTime:new Date().getTime(),updatedTime:new Date().getTime()},x=await r.set(l);c.value=x,setTimeout(()=>{c.value=""},100)},d=()=>{n.push({name:"home"})},C=l=>{const x=p.value.find(O=>O.id===l.id);x.name=l.name,x.updatedTime=new Date().getTime(),r.set(x)},I=l=>{const x=p.value.find(O=>O.id===l.id);x.name=l.name,x.updatedTime=new Date().getTime(),o.set(x)},S=l=>{ee.confirm("确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{r.del(l.id),te({type:"success",message:"删除成功"})})},B=l=>{ee.confirm("确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{o.del(l.id),te({type:"success",message:"删除成功"})})},N=()=>{u.value=!0};return U.on("createFolder",()=>{E()}),U.on("createChart",()=>{N()}),Q(async()=>{await r.update(),await o.update(),v.value=!1}),(l,x)=>{const O=w("el-empty"),ce=_e("loading");return s(),m("div",Qe,[h(i(Ce)),W((s(),m("div",We,[i(b)&&i(T)?(s(),m("div",{key:0,class:"back",onClick:d},[Xe,$(" "+j(i(T).name),1)])):R("",!0),t("div",Ye,[i(b)?R("",!0):(s(),m(M,{key:0},[(s(!0),m(M,null,P(i(p),V=>(s(),D(i(Se),{key:V.id,editId:c.value,folder:V,onChange:C,onDel:S},null,8,["editId","folder"]))),128)),(s(!0),m(M,null,P(i(g),V=>(s(),D(i(je),{key:V.id,chart:V,onChange:I,onDel:B},null,8,["chart"]))),128))],64))]),!i(p).length&&!v.value?(s(),D(O,{key:1,description:"当前内容为空","image-size":200})):R("",!0),u.value?(s(),D(i(He),{key:2,onClose:x[0]||(x[0]=V=>u.value=!1)})):R("",!0)])),[[ce,v.value]])])}}});const ot=H(Ze,[["__scopeId","data-v-eb6655d1"]]);export{ot as default};
