import{d as S,c as C,r as I,o as l,a as p,b as d,e as v,w as m,u as _,f as E,g as T,h,i as y,j as ce,k as ie,l as le,C as we,m as be,t as k,n as q,p as de,q as ue,s as _e,_ as P,v as z,F as G,x as Ce,y as De,E as Be,z as Ee}from"./index-cfe44686.js";const xe="/charts/logo.svg";function Me(e){return{all:e=e||new Map,on:function(t,n){var s=e.get(t);s?s.push(n):e.set(t,[n])},off:function(t,n){var s=e.get(t);s&&(n?s.splice(s.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var s=e.get(t);s&&s.slice().map(function(o){o(n)}),(s=e.get("*"))&&s.slice().map(function(o){o(t,n)})}}}const O=Me(),Ae={class:"topbar"},Ne={class:"logo",title:"charts"},Te=d("img",{src:xe,alt:"charts"},null,-1),ke={class:"right"},Se=d("i",{class:"iconfont icon-jia"},null,-1),Re=d("i",{class:"iconfont icon-jia"},null,-1),Le=d("i",{class:"iconfont icon-search-2-copy"},null,-1),Fe=S({__name:"topbar",setup(e){const t=ce(),n=C(()=>t.params.type),s=C(()=>n.value==="folder"),o=I(""),c=()=>{O.emit("createFolder","")},r=()=>{O.emit("createChart","")};return(u,a)=>{const i=h("router-link"),w=h("el-button"),B=h("el-input");return l(),p("div",Ae,[d("h1",Ne,[v(i,{tag:"a",to:{name:"home"}},{default:m(()=>[Te,y(" Charts ")]),_:1})]),d("div",ke,[v(w,{size:"large",onClick:r},{default:m(()=>[Se,y("新建图表 ")]),_:1}),_(s)?T("",!0):(l(),E(w,{key:0,size:"large",onClick:c},{default:m(()=>[Re,y("新建文件夹 ")]),_:1})),v(B,{modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=M=>o.value=M),size:"large",class:"search",placeholder:"在当前页面搜索"},{prefix:m(()=>[Le]),_:1},8,["modelValue"])])])}}});const fe="/charts/assets/DYNAMIC_LINE_BAR_MIX-a5981d26.gif",me="/charts/assets/DYNAMIC_RANKING_BAR-097dd3db.gif",pe="/charts/assets/LINE_BASICS-35682591.gif",Oe="/charts/assets/folder-big-144a6fca.svg",Pe="/charts/assets/plus-6fef50b3.svg",$e=e=>new URL(Object.assign({"../assets/images/charts/DYNAMIC_LINE_BAR_MIX.gif":fe,"../assets/images/charts/DYNAMIC_RANKING_BAR.gif":me,"../assets/images/charts/LINE_BASICS.gif":pe,"../assets/images/folder-big.svg":Oe,"../assets/images/plus.svg":Pe})[`../assets/images/${e}`],self.location).href,je=e=>new URL(Object.assign({"../assets/images/charts/DYNAMIC_LINE_BAR_MIX.gif":fe,"../assets/images/charts/DYNAMIC_RANKING_BAR.gif":me,"../assets/images/charts/LINE_BASICS.gif":pe})[`../assets/images/charts/${e}`],self.location).href,$=e=>(de("data-v-a1d9559d"),e=e(),ue(),e),Ve={class:"folder-box"},Ke=["src"],Ye=$(()=>d("div",{class:"operation"},[d("i",{class:"iconfont icon-gengduo"})],-1)),We=$(()=>d("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Xe=$(()=>d("i",{class:"iconfont icon-shanchu"},null,-1)),ze={class:"name"},Ge=$(()=>d("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Ue=S({__name:"folder",props:{folder:{type:Object,default:()=>({})},editId:{type:Number,default:null}},emits:["change","del"],setup(e,{emit:t}){const n=e,s=_e(),o=I("未命名文件夹"),c=I(""),r=I(!1),u=I(null),a=()=>{r.value=!0,i()},i=()=>{q(()=>{var b;(b=u.value)==null||b.select()})},w=()=>{s.push({name:"home",params:{type:"folder",id:n.folder.id}})},B=()=>{o.value||(o.value=c.value),r.value=!1,t("change",{...n.folder,name:o.value})},M=()=>{B()},V=b=>{b==="del"&&t("del",n.folder),b==="edit"&&q(()=>{a()})},K=()=>{B()};return ie(()=>{o.value=n.folder.name,c.value=n.folder.name,n.folder.id===n.editId&&a()}),(b,R)=>{const f=h("el-dropdown-item"),g=h("el-dropdown-menu"),A=h("el-dropdown"),Y=h("el-input");return l(),p("div",Ve,[d("div",{class:"content",onClick:w},[d("img",{src:_($e)("folder-big.svg")},null,8,Ke),v(A,{teleported:!1,onCommand:V},{dropdown:m(()=>[v(g,null,{default:m(()=>[v(f,{command:"edit"},{default:m(()=>[We,y(" 编辑 ")]),_:1}),v(f,{command:"del"},{default:m(()=>[Xe,y(" 删除 ")]),_:1})]),_:1})]),default:m(()=>[Ye]),_:1})]),d("div",ze,[r.value?le((l(),E(Y,{key:0,ref_key:"inputRef",ref:u,modelValue:o.value,"onUpdate:modelValue":R[0]||(R[0]=N=>o.value=N),modelModifiers:{trim:!0},onKeydown:be(M,["enter"])},null,8,["modelValue","onKeydown"])),[[_(we),K]]):(l(),p("div",{key:1,class:"text",onClick:a},[y(k(o.value)+" ",1),Ge]))])])}}});const He=P(Ue,[["__scopeId","data-v-a1d9559d"]]),Je=S({__name:"previewImage",props:{chart:{type:Object,default:()=>({})}},setup(e){const t=e,n=C(()=>je(t.chart.value+".gif"));return(s,o)=>{const c=h("el-image");return l(),E(c,{src:_(n),fit:"cover"},null,8,["src"])}}});const Qe=P(Je,[["__scopeId","data-v-db2dfecd"]]),U="DYNAMIC",he="LINE",ee={[U]:"动态图表",[he]:"线形图"},te={[U+"_RANKING_BAR"]:"动态排名变化图",[U+"_LINE_BAR_MIX"]:"动态折线条形混合图",[he+"_BASICS"]:"基础折线图"},Ze=Object.keys(te).map(e=>({label:te[e],value:e})),qe=()=>Object.keys(ee).map(e=>({label:ee[e],value:e,children:Ze.filter(t=>{const n=t.value.indexOf(e);return~n&&n===0})})),et={class:"container"},tt={class:"chart-wrapper"},nt=S({__name:"chartTemplate",emits:["close"],setup(e,{emit:t}){const n=I(qe()),s=()=>{t("close")};return(o,c)=>{const r=h("el-divider"),u=h("el-dialog");return l(),E(u,{fullscreen:!0,"model-value":!0,title:"图表模版","before-close":s},{default:m(()=>[d("div",et,[(l(!0),p(G,null,z(n.value,a=>(l(),p("div",{key:a.value},[v(r,{"content-position":"left"},{default:m(()=>[y(k(a.label),1)]),_:2},1024),d("div",tt,[(l(!0),p(G,null,z(a.children,i=>(l(),p("div",{key:i.value,class:"chart-block"},[y(k(i.label)+" - "+k(i.value)+" ",1),v(_(Qe),{chart:i},null,8,["chart"])]))),128))])]))),128))])]),_:1})}}});const st=P(nt,[["__scopeId","data-v-04070478"]]),H=(e,t)=>t.some(n=>e instanceof n);let ne,se;function ot(){return ne||(ne=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function at(){return se||(se=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ge=new WeakMap,J=new WeakMap,ve=new WeakMap,W=new WeakMap,j=new WeakMap;function rt(e){const t=new Promise((n,s)=>{const o=()=>{e.removeEventListener("success",c),e.removeEventListener("error",r)},c=()=>{n(D(e.result)),o()},r=()=>{s(e.error),o()};e.addEventListener("success",c),e.addEventListener("error",r)});return t.then(n=>{n instanceof IDBCursor&&ge.set(n,e)}).catch(()=>{}),j.set(t,e),t}function ct(e){if(J.has(e))return;const t=new Promise((n,s)=>{const o=()=>{e.removeEventListener("complete",c),e.removeEventListener("error",r),e.removeEventListener("abort",r)},c=()=>{n(),o()},r=()=>{s(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",c),e.addEventListener("error",r),e.addEventListener("abort",r)});J.set(e,t)}let Q={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return J.get(e);if(t==="objectStoreNames")return e.objectStoreNames||ve.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return D(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function Ie(e){Q=e(Q)}function it(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const s=e.call(F(this),t,...n);return ve.set(s,t.sort?t.sort():[t]),D(s)}:at().includes(e)?function(...t){return e.apply(F(this),t),D(ge.get(this))}:function(...t){return D(e.apply(F(this),t))}}function lt(e){return typeof e=="function"?it(e):(e instanceof IDBTransaction&&ct(e),H(e,ot())?new Proxy(e,Q):e)}function D(e){if(e instanceof IDBRequest)return rt(e);if(W.has(e))return W.get(e);const t=lt(e);return t!==e&&(W.set(e,t),j.set(t,e)),t}const F=e=>j.get(e);function dt(e,t,{blocked:n,upgrade:s,blocking:o,terminated:c}={}){const r=indexedDB.open(e,t),u=D(r);return s&&r.addEventListener("upgradeneeded",a=>{s(D(r.result),a.oldVersion,a.newVersion,D(r.transaction),a)}),n&&r.addEventListener("blocked",a=>n(a.oldVersion,a.newVersion,a)),u.then(a=>{c&&a.addEventListener("close",()=>c()),o&&a.addEventListener("versionchange",i=>o(i.oldVersion,i.newVersion,i))}).catch(()=>{}),u}const ut=["get","getKey","getAll","getAllKeys","count"],_t=["put","add","delete","clear"],X=new Map;function oe(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(X.get(t))return X.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,o=_t.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(o||ut.includes(n)))return;const c=async function(r,...u){const a=this.transaction(r,o?"readwrite":"readonly");let i=a.store;return s&&(i=i.index(u.shift())),(await Promise.all([i[n](...u),o&&a.done]))[0]};return X.set(t,c),c}Ie(e=>({...e,get:(t,n,s)=>oe(t,n)||e.get(t,n,s),has:(t,n)=>!!oe(t,n)||e.has(t,n)}));const ft=["continue","continuePrimaryKey","advance"],ae={},Z=new WeakMap,ye=new WeakMap,mt={get(e,t){if(!ft.includes(t))return e[t];let n=ae[t];return n||(n=ae[t]=function(...s){Z.set(this,ye.get(this)[t](...s))}),n}};async function*pt(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,mt);for(ye.set(n,t),j.set(n,F(t));t;)yield n,t=await(Z.get(n)||t.continue()),Z.delete(n)}function re(e,t){return t===Symbol.asyncIterator&&H(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&H(e,[IDBIndex,IDBObjectStore])}Ie(e=>({...e,get(t,n,s){return re(t,n)?pt:e.get(t,n,s)},has(t,n){return re(t,n)||e.has(t,n)}}));const ht="charts-",x="folder",gt=ht+x,vt=1,L=dt(gt,vt,{upgrade(e){e.createObjectStore(x,{keyPath:"id",autoIncrement:!0}).createIndex("id","id",{unique:!0})}}),It=Ce("Folder",{state:()=>({list:[]}),actions:{async update(){const e=await(await L).getAllFromIndex(x,"id");this.list=(e||[]).sort((t,n)=>n.updatedTime-t.updatedTime)},async get(e){return await(await L).get(x,e)},async set(e){const t=(await L).transaction(x,"readwrite");if(e.id){const n=t.store.index("id");for await(const s of n.iterate(e.id)){const o=Object.assign(s.value,e);s.update(o)}return await t.done,e.id}else{const n=await t.store.add(e);return this.update(),await t.done,n}},async del(e){await(await L).delete(x,e),this.update()}}}),yt=e=>(de("data-v-ab4a4d02"),e=e(),ue(),e),wt={class:"home"},bt={class:"wrapper"},Ct=yt(()=>d("i",{class:"iconfont icon-fanhui"},null,-1)),Dt={class:"container"},Bt=S({__name:"home",setup(e){const t=ce(),n=_e(),s=It(),o=C(()=>s.list),c=C(()=>t.params.type),r=C(()=>+t.params.id),u=C(()=>c.value==="folder"),a=I(!0),i=I(null),w=I(!0),B=C(()=>o.value.find(f=>f.id===r.value)),M=async()=>{const f={name:"未命名文件夹",createdTime:new Date().getTime(),updatedTime:new Date().getTime()},g=await s.set(f);i.value=g,setTimeout(()=>{i.value=""},100)},V=()=>{n.push({name:"home"})},K=f=>{const g=o.value.find(A=>A.id===f.id);g.name=f.name,g.updatedTime=new Date().getTime(),s.set(g)},b=f=>{Be.confirm("确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{s.del(f.id),Ee({type:"success",message:"删除成功"})})},R=()=>{w.value=!0};return O.on("createFolder",()=>{M()}),O.on("createChart",()=>{R()}),ie(async()=>{await s.update(),a.value=!1}),(f,g)=>{const A=h("el-empty"),Y=De("loading");return l(),p("div",wt,[v(_(Fe)),le((l(),p("div",bt,[_(u)&&_(B)?(l(),p("div",{key:0,class:"back",onClick:V},[Ct,y(" "+k(_(B).name),1)])):T("",!0),d("div",Dt,[_(u)?T("",!0):(l(!0),p(G,{key:0},z(_(o),N=>(l(),E(_(He),{key:N.id,editId:i.value,folder:N,onChange:K,onDel:b},null,8,["editId","folder"]))),128)),!_(o).length&&!a.value?(l(),E(A,{key:1,description:"当前内容为空","image-size":200})):T("",!0)]),w.value?(l(),E(_(st),{key:1,onClose:g[0]||(g[0]=N=>w.value=!1)})):T("",!0)])),[[Y,a.value]])])}}});const xt=P(Bt,[["__scopeId","data-v-ab4a4d02"]]);export{xt as default};
