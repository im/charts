import{d as N,c as B,r as w,o as l,a as p,b as c,e as h,w as f,u,f as E,g as O,h as v,i as b,j as ve,k as ae,l as re,C as ge,m as ye,t as j,n as H,p as ce,q as ie,s as le,_ as V,v as we,x as z,F as P,y as Ne,E as $e,z as Re}from"./index-dba04973.js";const Oe="/charts/logo.svg";function Le(e){return{all:e=e||new Map,on:function(t,n){var s=e.get(t);s?s.push(n):e.set(t,[n])},off:function(t,n){var s=e.get(t);s&&(n?s.splice(s.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var s=e.get(t);s&&s.slice().map(function(o){o(n)}),(s=e.get("*"))&&s.slice().map(function(o){o(t,n)})}}}const U=Le(),Fe={class:"topbar"},Pe={class:"logo",title:"charts"},je=c("img",{src:Oe,alt:"charts"},null,-1),Ve={class:"right"},Ke=c("i",{class:"iconfont icon-jia"},null,-1),Ye=c("i",{class:"iconfont icon-jia"},null,-1),We=c("i",{class:"iconfont icon-search-2-copy"},null,-1),Xe=N({__name:"topbar",setup(e){const t=ve(),n=B(()=>t.params.type),s=B(()=>n.value==="folder"),o=w(""),r=()=>{U.emit("createFolder","")},a=()=>{U.emit("createChart","")};return(_,i)=>{const d=v("router-link"),g=v("el-button"),m=v("el-input");return l(),p("div",Fe,[c("h1",Pe,[h(d,{tag:"a",to:{name:"home"}},{default:f(()=>[je,b(" Charts ")]),_:1})]),c("div",Ve,[h(g,{size:"large",onClick:a},{default:f(()=>[Ke,b("新建图表 ")]),_:1}),u(s)?O("",!0):(l(),E(g,{key:0,size:"large",onClick:r},{default:f(()=>[Ye,b("新建文件夹 ")]),_:1})),h(m,{modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=D=>o.value=D),size:"large",class:"search",placeholder:"在当前页面搜索"},{prefix:f(()=>[We]),_:1},8,["modelValue"])])])}}});const Ie="/charts/assets/DYNAMIC_LINE_BAR_MIX-a5981d26.gif",Ce="/charts/assets/DYNAMIC_RANKING_BAR-097dd3db.gif",be="/charts/assets/LINE_BASICS-35682591.gif",He="/charts/assets/folder-big-144a6fca.svg",ze="/charts/assets/plus-6fef50b3.svg",Ue=e=>new URL(Object.assign({"../assets/images/charts/DYNAMIC_LINE_BAR_MIX.gif":Ie,"../assets/images/charts/DYNAMIC_RANKING_BAR.gif":Ce,"../assets/images/charts/LINE_BASICS.gif":be,"../assets/images/folder-big.svg":He,"../assets/images/plus.svg":ze})[`../assets/images/${e}`],self.location).href,Ge=e=>new URL(Object.assign({"../assets/images/charts/DYNAMIC_LINE_BAR_MIX.gif":Ie,"../assets/images/charts/DYNAMIC_RANKING_BAR.gif":Ce,"../assets/images/charts/LINE_BASICS.gif":be})[`../assets/images/charts/${e}`],self.location).href,G=e=>(ce("data-v-a1d9559d"),e=e(),ie(),e),qe={class:"folder-box"},Je=["src"],Qe=G(()=>c("div",{class:"operation"},[c("i",{class:"iconfont icon-gengduo"})],-1)),Ze=G(()=>c("i",{class:"iconfont icon-weibiaoti520"},null,-1)),et=G(()=>c("i",{class:"iconfont icon-shanchu"},null,-1)),tt={class:"name"},nt=G(()=>c("i",{class:"iconfont icon-weibiaoti520"},null,-1)),st=N({__name:"folder",props:{folder:{type:Object,default:()=>({})},editId:{type:Number,default:null}},emits:["change","del"],setup(e,{emit:t}){const n=e,s=le(),o=w("未命名文件夹"),r=w(""),a=w(!1),_=w(null),i=()=>{a.value=!0,d()},d=()=>{H(()=>{var C;(C=_.value)==null||C.select()})},g=()=>{s.push({name:"home",params:{type:"folder",id:n.folder.id}})},m=()=>{o.value||(o.value=r.value),a.value=!1,t("change",{...n.folder,name:o.value})},D=()=>{m()},I=C=>{C==="del"&&t("del",n.folder),C==="edit"&&H(()=>{i()})},k=()=>{m()};return ae(()=>{o.value=n.folder.name,r.value=n.folder.name,n.folder.id===n.editId&&i()}),(C,S)=>{const A=v("el-dropdown-item"),$=v("el-dropdown-menu"),y=v("el-dropdown"),x=v("el-input");return l(),p("div",qe,[c("div",{class:"content",onClick:g},[c("img",{src:u(Ue)("folder-big.svg")},null,8,Je),h(y,{teleported:!1,onCommand:I},{dropdown:f(()=>[h($,null,{default:f(()=>[h(A,{command:"edit"},{default:f(()=>[Ze,b(" 编辑 ")]),_:1}),h(A,{command:"del"},{default:f(()=>[et,b(" 删除 ")]),_:1})]),_:1})]),default:f(()=>[Qe]),_:1})]),c("div",tt,[a.value?re((l(),E(x,{key:0,ref_key:"inputRef",ref:_,modelValue:o.value,"onUpdate:modelValue":S[0]||(S[0]=R=>o.value=R),modelModifiers:{trim:!0},onKeydown:ye(D,["enter"])},null,8,["modelValue","onKeydown"])),[[u(ge),k]]):(l(),p("div",{key:1,class:"text",onClick:i},[b(j(o.value)+" ",1),nt]))])])}}});const ot=V(st,[["__scopeId","data-v-a1d9559d"]]),at=N({__name:"previewImage",props:{chart:{type:Object,default:()=>({})}},setup(e){const t=e,n=B(()=>Ge((t.chart.value||t.chart.type)+".gif"));return(s,o)=>{const r=v("el-image");return l(),E(r,{src:u(n),fit:"cover"},null,8,["src"])}}});const De=V(at,[["__scopeId","data-v-a7a00566"]]),q=e=>(ce("data-v-8a528de8"),e=e(),ie(),e),rt={class:"chart-box"},ct={class:"content"},it=q(()=>c("div",{class:"operation"},[c("i",{class:"iconfont icon-gengduo"})],-1)),lt=q(()=>c("i",{class:"iconfont icon-weibiaoti520"},null,-1)),dt=q(()=>c("i",{class:"iconfont icon-shanchu"},null,-1)),ut={class:"name"},_t=q(()=>c("i",{class:"iconfont icon-weibiaoti520"},null,-1)),ft=N({__name:"chartItem",props:{chart:{type:Object,default:()=>({})},editId:{type:Number,default:null}},emits:["change","del"],setup(e,{emit:t}){const n=e;le();const s=w(""),o=w(""),r=w(!1),a=w(null),_=()=>{r.value=!0,i()},i=()=>{H(()=>{var I;(I=a.value)==null||I.select()})},d=()=>{s.value||(s.value=o.value),r.value=!1,t("change",{...n.chart,name:s.value})},g=()=>{d()},m=I=>{I==="del"&&t("del",n.chart),I==="edit"&&H(()=>{_()})},D=()=>{d()};return ae(()=>{s.value=n.chart.name}),(I,k)=>{const C=v("el-dropdown-item"),S=v("el-dropdown-menu"),A=v("el-dropdown"),$=v("el-input");return l(),p("div",rt,[c("div",ct,[h(u(De),{chart:e.chart},null,8,["chart"]),h(A,{teleported:!1,onCommand:m},{dropdown:f(()=>[h(S,null,{default:f(()=>[h(C,{command:"edit"},{default:f(()=>[lt,b(" 编辑 ")]),_:1}),h(C,{command:"del"},{default:f(()=>[dt,b(" 删除 ")]),_:1})]),_:1})]),default:f(()=>[it]),_:1})]),c("div",ut,[r.value?re((l(),E($,{key:0,ref_key:"inputRef",ref:a,modelValue:s.value,"onUpdate:modelValue":k[0]||(k[0]=y=>s.value=y),modelModifiers:{trim:!0},onKeydown:ye(g,["enter"])},null,8,["modelValue","onKeydown"])),[[u(ge),D]]):(l(),p("div",{key:1,class:"text",onClick:_},[c("span",null,j(s.value),1),b(),_t]))])])}}});const mt=V(ft,[["__scopeId","data-v-8a528de8"]]),ee="DYNAMIC",xe="LINE",de={[ee]:"动态图表",[xe]:"线形图"},ue={[ee+"_RANKING_BAR"]:"动态排名变化图",[ee+"_LINE_BAR_MIX"]:"动态折线条形混合图",[xe+"_BASICS"]:"基础折线图"},pt=Object.keys(ue).map(e=>({label:ue[e],value:e})),ht=()=>Object.keys(de).map(e=>({label:de[e],value:e,children:pt.filter(t=>{const n=t.value.indexOf(e);return~n&&n===0})})),te=(e,t)=>t.some(n=>e instanceof n);let _e,fe;function vt(){return _e||(_e=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function gt(){return fe||(fe=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Be=new WeakMap,ne=new WeakMap,Ee=new WeakMap,Q=new WeakMap,J=new WeakMap;function yt(e){const t=new Promise((n,s)=>{const o=()=>{e.removeEventListener("success",r),e.removeEventListener("error",a)},r=()=>{n(T(e.result)),o()},a=()=>{s(e.error),o()};e.addEventListener("success",r),e.addEventListener("error",a)});return t.then(n=>{n instanceof IDBCursor&&Be.set(n,e)}).catch(()=>{}),J.set(t,e),t}function wt(e){if(ne.has(e))return;const t=new Promise((n,s)=>{const o=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",a),e.removeEventListener("abort",a)},r=()=>{n(),o()},a=()=>{s(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",r),e.addEventListener("error",a),e.addEventListener("abort",a)});ne.set(e,t)}let se={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return ne.get(e);if(t==="objectStoreNames")return e.objectStoreNames||Ee.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return T(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function Te(e){se=e(se)}function It(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const s=e.call(X(this),t,...n);return Ee.set(s,t.sort?t.sort():[t]),T(s)}:gt().includes(e)?function(...t){return e.apply(X(this),t),T(Be.get(this))}:function(...t){return T(e.apply(X(this),t))}}function Ct(e){return typeof e=="function"?It(e):(e instanceof IDBTransaction&&wt(e),te(e,vt())?new Proxy(e,se):e)}function T(e){if(e instanceof IDBRequest)return yt(e);if(Q.has(e))return Q.get(e);const t=Ct(e);return t!==e&&(Q.set(e,t),J.set(t,e)),t}const X=e=>J.get(e);function bt(e,t,{blocked:n,upgrade:s,blocking:o,terminated:r}={}){const a=indexedDB.open(e,t),_=T(a);return s&&a.addEventListener("upgradeneeded",i=>{s(T(a.result),i.oldVersion,i.newVersion,T(a.transaction),i)}),n&&a.addEventListener("blocked",i=>n(i.oldVersion,i.newVersion,i)),_.then(i=>{r&&i.addEventListener("close",()=>r()),o&&i.addEventListener("versionchange",d=>o(d.oldVersion,d.newVersion,d))}).catch(()=>{}),_}const Dt=["get","getKey","getAll","getAllKeys","count"],xt=["put","add","delete","clear"],Z=new Map;function me(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(Z.get(t))return Z.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,o=xt.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(o||Dt.includes(n)))return;const r=async function(a,..._){const i=this.transaction(a,o?"readwrite":"readonly");let d=i.store;return s&&(d=d.index(_.shift())),(await Promise.all([d[n](..._),o&&i.done]))[0]};return Z.set(t,r),r}Te(e=>({...e,get:(t,n,s)=>me(t,n)||e.get(t,n,s),has:(t,n)=>!!me(t,n)||e.has(t,n)}));const Bt=["continue","continuePrimaryKey","advance"],pe={},oe=new WeakMap,ke=new WeakMap,Et={get(e,t){if(!Bt.includes(t))return e[t];let n=pe[t];return n||(n=pe[t]=function(...s){oe.set(this,ke.get(this)[t](...s))}),n}};async function*Tt(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,Et);for(ke.set(n,t),J.set(n,X(t));t;)yield n,t=await(oe.get(n)||t.continue()),oe.delete(n)}function he(e,t){return t===Symbol.asyncIterator&&te(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&te(e,[IDBIndex,IDBObjectStore])}Te(e=>({...e,get(t,n,s){return he(t,n)?Tt:e.get(t,n,s)},has(t,n){return he(t,n)||e.has(t,n)}}));const kt="chart",St=1,L="folder",F="chart";let K=null;const Se=()=>K||(K=bt(kt,St,{upgrade(e){e.createObjectStore(F,{keyPath:"id",autoIncrement:!0}).createIndex("id","id",{unique:!0}),e.createObjectStore(L,{keyPath:"id",autoIncrement:!0}).createIndex("id","id",{unique:!0})}}),K),Y=Se(),Ae=we("Chart",{state:()=>({list:[]}),actions:{async update(){const e=await(await Y).getAllFromIndex(F,"id");this.list=(e||[]).sort((t,n)=>n.updatedTime-t.updatedTime)},async get(e){return await(await Y).get(F,e)},async set(e){const t=(await Y).transaction(F,"readwrite");if(e.id){const n=t.store.index("id");for await(const s of n.iterate(e.id)){const o=Object.assign(s.value,e);s.update(o)}return await t.done,e.id}else{const n=await t.store.add(e);return this.update(),await t.done,n}},async del(e){await(await Y).delete(F,e),this.update()}}}),At={class:"container"},Mt={class:"chart-wrapper"},Nt=["onClick"],$t={class:"preview"},Rt={class:"name-box"},Ot=N({__name:"chartTemplate",emits:["close"],setup(e,{emit:t}){const n=w(ht()),s=Ae(),o=()=>{t("close")},r=async a=>{const _={name:a.label,createdTime:new Date().getTime(),updatedTime:new Date().getTime(),type:a.value};await s.set(_)};return(a,_)=>{const i=v("el-divider"),d=v("el-dialog");return l(),E(d,{fullscreen:!0,"model-value":!0,title:"图表模版","before-close":o},{default:f(()=>[c("div",At,[(l(!0),p(P,null,z(n.value,g=>(l(),p("div",{key:g.value},[h(i,{"content-position":"left"},{default:f(()=>[b(j(g.label),1)]),_:2},1024),c("div",Mt,[(l(!0),p(P,null,z(g.children,m=>(l(),p("div",{key:m.value,class:"chart-block",onClick:D=>r(m)},[c("div",$t,[h(u(De),{chart:m},null,8,["chart"])]),c("div",Rt,j(m.label),1)],8,Nt))),128))])]))),128))])]),_:1})}}});const Lt=V(Ot,[["__scopeId","data-v-ede6dd2e"]]),W=Se(),Ft=we("Folder",{state:()=>({list:[]}),actions:{async update(){const e=await(await W).getAllFromIndex(L,"id");this.list=(e||[]).sort((t,n)=>n.updatedTime-t.updatedTime)},async get(e){return await(await W).get(L,e)},async set(e){const t=(await W).transaction(L,"readwrite");if(e.id){const n=t.store.index("id");for await(const s of n.iterate(e.id)){const o=Object.assign(s.value,e);s.update(o)}return await t.done,e.id}else{const n=await t.store.add(e);return this.update(),await t.done,n}},async del(e){await(await W).delete(L,e),this.update()}}}),Pt=e=>(ce("data-v-03ddc1e2"),e=e(),ie(),e),jt={class:"home"},Vt={class:"wrapper"},Kt=Pt(()=>c("i",{class:"iconfont icon-fanhui"},null,-1)),Yt={class:"container"},Wt=N({__name:"home",setup(e){const t=ve(),n=le(),s=Ft(),o=Ae(),r=B(()=>s.list),a=B(()=>o.list),_=B(()=>t.params.type),i=B(()=>+t.params.id),d=B(()=>_.value==="folder"),g=w(!0),m=w(null),D=w(!1),I=B(()=>r.value.find(y=>y.id===i.value)),k=async()=>{const y={name:"未命名文件夹",createdTime:new Date().getTime(),updatedTime:new Date().getTime()},x=await s.set(y);m.value=x,setTimeout(()=>{m.value=""},100)},C=()=>{n.push({name:"home"})},S=y=>{const x=r.value.find(R=>R.id===y.id);x.name=y.name,x.updatedTime=new Date().getTime(),s.set(x)},A=y=>{$e.confirm("确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{s.del(y.id),Re({type:"success",message:"删除成功"})})},$=()=>{D.value=!0};return U.on("createFolder",()=>{k()}),U.on("createChart",()=>{$()}),ae(async()=>{await s.update(),await o.update(),g.value=!1}),(y,x)=>{const R=v("el-empty"),Me=Ne("loading");return l(),p("div",jt,[h(u(Xe)),re((l(),p("div",Vt,[u(d)&&u(I)?(l(),p("div",{key:0,class:"back",onClick:C},[Kt,b(" "+j(u(I).name),1)])):O("",!0),c("div",Yt,[u(d)?O("",!0):(l(),p(P,{key:0},[(l(!0),p(P,null,z(u(r),M=>(l(),E(u(ot),{key:M.id,editId:m.value,folder:M,onChange:S,onDel:A},null,8,["editId","folder"]))),128)),(l(!0),p(P,null,z(u(a),M=>(l(),E(u(mt),{key:M.id,chart:M},null,8,["chart"]))),128))],64))]),!u(r).length&&!g.value?(l(),E(R,{key:1,description:"当前内容为空","image-size":200})):O("",!0),D.value?(l(),E(u(Lt),{key:2,onClose:x[0]||(x[0]=M=>D.value=!1)})):O("",!0)])),[[Me,g.value]])])}}});const Ht=V(Wt,[["__scopeId","data-v-03ddc1e2"]]);export{Ht as default};
