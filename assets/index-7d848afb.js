import{e as J,_ as ie,g as re,P as ne,D as ue,a as _e,u as se,b as pe,F as K,c as me}from"./lodash-6f118456.js";import{d as j,u as ae,c as T,r as w,o as a,a as h,b as t,e as f,w as v,f as C,g as x,h as W,i as X,j as d,k as B,l as Y,C as le,m as D,n as ce,t as M,p as P,q as Z,s as ee,_ as U,v as Q,F as q,x as he,y as L,z as fe,E as te,A as oe}from"./index-df7876ba.js";const ve={class:"topbar"},ye={class:"logo",title:"charts"},ge=t("img",{src:ie,alt:"charts"},null,-1),we={class:"right"},Ce=t("i",{class:"iconfont icon-jia"},null,-1),be=j({__name:"topbar",setup(e){const s=ae(),n=T(()=>s.params.type);T(()=>n.value==="folder"),w("");const i=()=>{J.emit("createChart","")};return(o,y)=>{const l=C("router-link"),u=C("el-button");return a(),h("div",ve,[t("h1",ye,[f(l,{tag:"a",to:{name:"home"}},{default:v(()=>[ge,x(" Charts ")]),_:1})]),t("div",we,[f(u,{size:"large",onClick:i},{default:v(()=>[Ce,x("新建图表 ")]),_:1})])])}}});const H=e=>(Z("data-v-0fc7734e"),e=e(),ee(),e),ke={class:"folder-box"},Te=["onClick"],xe=["src"],$e=H(()=>t("div",{class:"operation"},[t("i",{class:"iconfont icon-gengduo"})],-1)),Ie=H(()=>t("i",{class:"iconfont icon-weibiaoti520"},null,-1)),De=H(()=>t("i",{class:"iconfont icon-shanchu"},null,-1)),Se={class:"name"},Fe=H(()=>t("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Be=j({__name:"folder",props:{folder:{type:Object,default:()=>({})},editId:{type:Number,default:null}},emits:["change","del"],setup(e,{emit:s}){const n=e,i=W(),o=w("未命名文件夹"),y=w(""),l=w(!1),u=w(null),p=()=>{l.value=!0,m()},m=()=>{P(()=>{var _;(_=u.value)==null||_.select()})},k=()=>{i.push({name:"home",params:{type:"folder",id:n.folder.id}})},b=()=>{o.value||(o.value=y.value),l.value=!1,s("change",{...n.folder,name:o.value})},$=()=>{b()},S=_=>{_==="del"&&s("del",n.folder),_==="edit"&&P(()=>{p()})},E=()=>{b()};return X(()=>{o.value=n.folder.name,y.value=n.folder.name,n.folder.id===n.editId&&p()}),(_,r)=>{const I=C("el-dropdown-item"),V=C("el-dropdown-menu"),N=C("el-dropdown"),O=C("el-input");return a(),h("div",ke,[t("div",{class:"content",onClick:B(k,["stop"])},[t("img",{src:d(re)("folder-big.svg")},null,8,xe),f(N,{teleported:!1,onCommand:S},{dropdown:v(()=>[f(V,null,{default:v(()=>[f(I,{command:"edit",onClick:r[0]||(r[0]=B(()=>{},["stop"]))},{default:v(()=>[Ie,x(" 编辑 ")]),_:1}),f(I,{command:"del",onClick:r[1]||(r[1]=B(()=>{},["stop"]))},{default:v(()=>[De,x(" 删除 ")]),_:1})]),_:1})]),default:v(()=>[$e]),_:1})],8,Te),t("div",Se,[l.value?Y((a(),D(O,{key:0,ref_key:"inputRef",ref:u,modelValue:o.value,"onUpdate:modelValue":r[2]||(r[2]=R=>o.value=R),modelModifiers:{trim:!0},onKeydown:ce($,["enter"])},null,8,["modelValue","onKeydown"])),[[d(le),E]]):(a(),h("div",{key:1,class:"text",onClick:p},[x(M(o.value)+" ",1),Fe]))])])}}});const Ee=U(Be,[["__scopeId","data-v-0fc7734e"]]),A=e=>(Z("data-v-5fda0373"),e=e(),ee(),e),Ve={class:"chart-box"},Ne=A(()=>t("i",{class:"iconfont icon-gengduo"},null,-1)),Oe=[Ne],Re=A(()=>t("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Me=A(()=>t("i",{class:"iconfont icon-shanchu"},null,-1)),je=A(()=>t("div",{class:"edit-box"},[t("span",null,"编辑")],-1)),Ae={class:"name"},Ke=A(()=>t("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Le=j({__name:"chartItem",props:{chart:{type:Object,default:()=>({})},editId:{type:Number,default:null}},emits:["change","del"],setup(e,{emit:s}){const n=e,i=W(),o=w(""),y=w(""),l=w(!1),u=w(null),p=()=>{l.value=!0,m()},m=()=>{P(()=>{var _;(_=u.value)==null||_.select()})},k=()=>{i.push({name:"chart",params:{id:n.chart.id}})},b=()=>{o.value||(o.value=y.value),l.value=!1,s("change",{...n.chart,name:o.value})},$=()=>{b()},S=_=>{_==="del"&&s("del",n.chart),_==="edit"&&P(()=>{p()})},E=()=>{b()};return X(()=>{o.value=n.chart.name}),(_,r)=>{const I=C("el-dropdown-item"),V=C("el-dropdown-menu"),N=C("el-dropdown"),O=C("el-input");return a(),h("div",Ve,[t("div",{class:"content",onClick:k},[f(d(ne),{chart:e.chart},null,8,["chart"]),f(N,{teleported:!1,onCommand:S},{dropdown:v(()=>[f(V,null,{default:v(()=>[f(I,{command:"edit",onClick:r[1]||(r[1]=B(()=>{},["stop"]))},{default:v(()=>[Re,x(" 编辑 ")]),_:1}),f(I,{command:"del",onClick:r[2]||(r[2]=B(()=>{},["stop"]))},{default:v(()=>[Me,x(" 删除 ")]),_:1})]),_:1})]),default:v(()=>[t("div",{class:"operation",onClick:r[0]||(r[0]=B(()=>{},["stop"]))},Oe)]),_:1}),je]),t("div",Ae,[l.value?Y((a(),D(O,{key:0,ref_key:"inputRef",ref:u,modelValue:o.value,"onUpdate:modelValue":r[3]||(r[3]=R=>o.value=R),modelModifiers:{trim:!0},onKeydown:ce($,["enter"])},null,8,["modelValue","onKeydown"])),[[d(le),E]]):(a(),h("div",{key:1,class:"text",onClick:p},[t("span",null,M(o.value),1),x(),Ke]))])])}}});const ze=U(Le,[["__scopeId","data-v-5fda0373"]]);function qe(e){const s=e.value;return{data:ue[s],theme:"westeros",legend:!0,backgroundColor:"#ffffff",title:{show:!0,value:e.label,color:"#333333"},animation:{intervalTime:1,moveTime:.5,startDelayTime:0,endDelayTime:1,loop:0}}}const Pe={class:"container"},Ue=["onClick"],He={class:"tag"},Ge={class:"preview"},Je={class:"name-box"},Qe=j({__name:"chartTemplate",emits:["close"],setup(e,{emit:s}){const n=T(()=>_e().reduce((u,p)=>{const k=(p.children||[]).map(b=>({...b,parentLabel:p.label}));return u=u.concat(k),u},[])),i=se(),o=()=>{s("close")},y=async l=>{const u={name:l.label,createdTime:new Date().getTime(),updatedTime:new Date().getTime(),type:l.value,config:qe(l)};await i.set(u),o()};return(l,u)=>{const p=C("el-dialog");return a(),D(p,{fullscreen:!0,"model-value":!0,title:"图表模版","before-close":o},{default:v(()=>[t("div",Pe,[(a(!0),h(q,null,Q(d(n),m=>(a(),h("div",{key:m.value,class:"chart-block",onClick:k=>y(m)},[t("div",He,M(m.parentLabel),1),t("div",Ge,[f(d(ne),{chart:m},null,8,["chart"])]),t("div",Je,M(m.label),1)],8,Ue))),128))])]),_:1})}}});const We=U(Qe,[["__scopeId","data-v-bb557d2e"]]),z=pe(),Xe=he("Folder",{state:()=>({list:[]}),actions:{async update(){const e=await(await z).getAllFromIndex(K,"id");this.list=(e||[]).sort((s,n)=>n.updatedTime-s.updatedTime)},async get(e){return await(await z).get(K,e)},async set(e){const s=(await z).transaction(K,"readwrite");if(e.id){const n=s.store.index("id");for await(const i of n.iterate(e.id)){const o=Object.assign(i.value,e);i.update(o)}return await s.done,e.id}else{const n=await s.store.add(e);return this.update(),await s.done,n}},async del(e){await(await z).delete(K,e),this.update()}}}),Ye=e=>(Z("data-v-b0b5e834"),e=e(),ee(),e),Ze={class:"home"},et={class:"wrapper"},tt=Ye(()=>t("i",{class:"iconfont icon-fanhui"},null,-1)),ot={class:"container"},nt=j({__name:"home",setup(e){const s=ae(),n=W(),i=Xe(),o=se(),y=T(()=>i.list),l=T(()=>o.list),u=T(()=>s.params.type),p=T(()=>+s.params.id),m=T(()=>u.value==="folder"),k=w(!0),b=w(null),$=w(!1),S=T(()=>y.value.find(c=>c.id===p.value)),E=async()=>{const c={name:"未命名文件夹",createdTime:new Date().getTime(),updatedTime:new Date().getTime()},g=await i.set(c);b.value=g,setTimeout(()=>{b.value=""},100)},_=()=>{n.push({name:"home"})},r=c=>{const g=y.value.find(G=>G.id===c.id);g.name=c.name,g.updatedTime=new Date().getTime(),i.set(g)},I=c=>{const g=me.cloneDeep(c);g.updatedTime=new Date().getTime(),o.set(g)},V=c=>{te.confirm("确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{i.del(c.id),oe({type:"success",message:"删除成功"})})},N=c=>{te.confirm("确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{o.del(c.id),oe({type:"success",message:"删除成功"})})},O=()=>{$.value=!0};J.on("createFolder",()=>{E()}),J.on("createChart",()=>{O()});const R=()=>{const c=new BroadcastChannel("chart");c.onmessage=async g=>{await i.update(),await o.update()}};return X(async()=>{var c;(c=document.querySelector("html"))==null||c.classList.remove("dark"),await i.update(),await o.update(),k.value=!1,R()}),(c,g)=>{const G=C("el-empty"),de=fe("loading");return a(),h("div",Ze,[f(d(be)),Y((a(),h("div",et,[d(m)&&d(S)?(a(),h("div",{key:0,class:"back",onClick:_},[tt,x(" "+M(d(S).name),1)])):L("",!0),t("div",ot,[d(m)?L("",!0):(a(),h(q,{key:0},[(a(!0),h(q,null,Q(d(y),F=>(a(),D(d(Ee),{key:F.id,editId:b.value,folder:F,onChange:r,onDel:V},null,8,["editId","folder"]))),128)),(a(!0),h(q,null,Q(d(l),F=>(a(),D(d(ze),{key:F.id,chart:F,onChange:I,onDel:N},null,8,["chart"]))),128))],64))]),!d(y).length&&!d(l).length&&!k.value?(a(),D(G,{key:1,description:"当前内容为空","image-size":200})):L("",!0),$.value?(a(),D(d(We),{key:2,onClose:g[0]||(g[0]=F=>$.value=!1)})):L("",!0)])),[[de,k.value]])])}}});const lt=U(nt,[["__scopeId","data-v-b0b5e834"]]);export{lt as default};
