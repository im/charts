import{e as W,_ as de,g as re,P as ne,D as ue,a as _e,u as se,b as me,F as L}from"./index-3fd11225.js";import{d as z,u as ae,c as $,r as y,o as s,a as u,b as t,e as v,w,f as g,g as T,h as H,i as X,j as d,k as B,l as Y,C as le,m as D,n as ce,t as A,p as K,q as Z,s as ee,_ as G,v as U,F as j,x as pe,y as q,z as he,E as te,A as oe}from"./index-f831ef1d.js";const fe={class:"topbar"},ve={class:"logo",title:"charts"},we=t("img",{src:de,alt:"charts"},null,-1),ye={class:"right"},ge=t("i",{class:"iconfont icon-jia"},null,-1),Ce=z({__name:"topbar",setup(e){const a=ae(),n=$(()=>a.params.type);$(()=>n.value==="folder"),y("");const c=()=>{W.emit("createChart","")};return(o,_)=>{const m=g("router-link"),p=g("el-button");return s(),u("div",fe,[t("h1",ve,[v(m,{tag:"a",to:{name:"home"}},{default:w(()=>[we,T(" Charts ")]),_:1})]),t("div",ye,[v(p,{size:"large",onClick:c},{default:w(()=>[ge,T("新建图表 ")]),_:1})])])}}});const J=e=>(Z("data-v-0fc7734e"),e=e(),ee(),e),ke={class:"folder-box"},be=["onClick"],Te=["src"],xe=J(()=>t("div",{class:"operation"},[t("i",{class:"iconfont icon-gengduo"})],-1)),$e=J(()=>t("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Ie=J(()=>t("i",{class:"iconfont icon-shanchu"},null,-1)),De={class:"name"},Se=J(()=>t("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Fe=z({__name:"folder",props:{folder:{type:Object,default:()=>({})},editId:{type:Number,default:null}},emits:["change","del"],setup(e,{emit:a}){const n=e,c=H(),o=y("未命名文件夹"),_=y(""),m=y(!1),p=y(null),C=()=>{m.value=!0,b()},b=()=>{K(()=>{var r;(r=p.value)==null||r.select()})},k=()=>{c.push({name:"home",params:{type:"folder",id:n.folder.id}})},h=()=>{o.value||(o.value=_.value),m.value=!1,a("change",{...n.folder,name:o.value})},x=()=>{h()},S=r=>{r==="del"&&a("del",n.folder),r==="edit"&&K(()=>{C()})},E=()=>{h()};return X(()=>{o.value=n.folder.name,_.value=n.folder.name,n.folder.id===n.editId&&C()}),(r,i)=>{const I=g("el-dropdown-item"),V=g("el-dropdown-menu"),N=g("el-dropdown"),O=g("el-input");return s(),u("div",ke,[t("div",{class:"content",onClick:B(k,["stop"])},[t("img",{src:d(re)("folder-big.svg")},null,8,Te),v(N,{teleported:!1,onCommand:S},{dropdown:w(()=>[v(V,null,{default:w(()=>[v(I,{command:"edit",onClick:i[0]||(i[0]=B(()=>{},["stop"]))},{default:w(()=>[$e,T(" 编辑 ")]),_:1}),v(I,{command:"del",onClick:i[1]||(i[1]=B(()=>{},["stop"]))},{default:w(()=>[Ie,T(" 删除 ")]),_:1})]),_:1})]),default:w(()=>[xe]),_:1})],8,be),t("div",De,[m.value?Y((s(),D(O,{key:0,ref_key:"inputRef",ref:p,modelValue:o.value,"onUpdate:modelValue":i[2]||(i[2]=R=>o.value=R),modelModifiers:{trim:!0},onKeydown:ce(x,["enter"])},null,8,["modelValue","onKeydown"])),[[d(le),E]]):(s(),u("div",{key:1,class:"text",onClick:C},[T(A(o.value)+" ",1),Se]))])])}}});const Be=G(Fe,[["__scopeId","data-v-0fc7734e"]]),Q=e=>(Z("data-v-2f918797"),e=e(),ee(),e),Ee={class:"chart-box"},Ve=Q(()=>t("i",{class:"iconfont icon-gengduo"},null,-1)),Ne=[Ve],Oe=Q(()=>t("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Re=Q(()=>t("i",{class:"iconfont icon-shanchu"},null,-1)),Me={class:"name"},je=Q(()=>t("i",{class:"iconfont icon-weibiaoti520"},null,-1)),Ae=z({__name:"chartItem",props:{chart:{type:Object,default:()=>({})},editId:{type:Number,default:null}},emits:["change","del"],setup(e,{emit:a}){const n=e,c=H(),o=y(""),_=y(""),m=y(!1),p=y(null),C=()=>{m.value=!0,b()},b=()=>{K(()=>{var r;(r=p.value)==null||r.select()})},k=()=>{c.push({name:"chart",params:{id:n.chart.id}})},h=()=>{o.value||(o.value=_.value),m.value=!1,a("change",{...n.chart,name:o.value})},x=()=>{h()},S=r=>{r==="del"&&a("del",n.chart),r==="edit"&&K(()=>{C()})},E=()=>{h()};return X(()=>{o.value=n.chart.name}),(r,i)=>{const I=g("el-dropdown-item"),V=g("el-dropdown-menu"),N=g("el-dropdown"),O=g("el-input");return s(),u("div",Ee,[t("div",{class:"content",onClick:k},[v(d(ne),{chart:e.chart},null,8,["chart"]),v(N,{teleported:!1,onCommand:S},{dropdown:w(()=>[v(V,null,{default:w(()=>[v(I,{command:"edit",onClick:i[1]||(i[1]=B(()=>{},["stop"]))},{default:w(()=>[Oe,T(" 编辑 ")]),_:1}),v(I,{command:"del",onClick:i[2]||(i[2]=B(()=>{},["stop"]))},{default:w(()=>[Re,T(" 删除 ")]),_:1})]),_:1})]),default:w(()=>[t("div",{class:"operation",onClick:i[0]||(i[0]=B(()=>{},["stop"]))},Ne)]),_:1})]),t("div",Me,[m.value?Y((s(),D(O,{key:0,ref_key:"inputRef",ref:p,modelValue:o.value,"onUpdate:modelValue":i[3]||(i[3]=R=>o.value=R),modelModifiers:{trim:!0},onKeydown:ce(x,["enter"])},null,8,["modelValue","onKeydown"])),[[d(le),E]]):(s(),u("div",{key:1,class:"text",onClick:C},[t("span",null,A(o.value),1),T(),je]))])])}}});const Ke=G(Ae,[["__scopeId","data-v-2f918797"]]);function ze(e){const a=e.value;return{data:ue[a],theme:"westeros",legend:!0,title:{show:!0,value:e.label},animation:{intervalTime:1,moveTime:.5,startDelayTime:0,endDelayTime:1,loop:0}}}const Le={class:"container"},qe={class:"chart-wrapper"},Pe=["onClick"],Ue={class:"tag"},He={class:"preview"},Ge={class:"name-box"},Je=z({__name:"chartTemplate",emits:["close"],setup(e,{emit:a}){const n=H(),c=y(_e()),o=se(),_=()=>{a("close")},m=async p=>{const C={name:p.label,createdTime:new Date().getTime(),updatedTime:new Date().getTime(),type:p.value,config:ze(p)},b=await o.set(C);n.push({name:"chart",params:{id:b}}),K(()=>{_()})};return(p,C)=>{const b=g("el-dialog");return s(),D(b,{fullscreen:!0,"model-value":!0,title:"图表模版","before-close":_},{default:w(()=>[t("div",Le,[(s(!0),u(j,null,U(c.value,k=>(s(),u("div",{key:k.value,class:"chart-list"},[t("div",qe,[(s(!0),u(j,null,U(k.children,h=>(s(),u("div",{key:h.value,class:"chart-block",onClick:x=>m(h)},[t("div",Ue,A(k.label),1),t("div",He,[v(d(ne),{chart:h},null,8,["chart"])]),t("div",Ge,A(h.label),1)],8,Pe))),128))])]))),128))])]),_:1})}}});const Qe=G(Je,[["__scopeId","data-v-e466e30a"]]),P=me(),We=pe("Folder",{state:()=>({list:[]}),actions:{async update(){const e=await(await P).getAllFromIndex(L,"id");this.list=(e||[]).sort((a,n)=>n.updatedTime-a.updatedTime)},async get(e){return await(await P).get(L,e)},async set(e){const a=(await P).transaction(L,"readwrite");if(e.id){const n=a.store.index("id");for await(const c of n.iterate(e.id)){const o=Object.assign(c.value,e);c.update(o)}return await a.done,e.id}else{const n=await a.store.add(e);return this.update(),await a.done,n}},async del(e){await(await P).delete(L,e),this.update()}}}),Xe=e=>(Z("data-v-7073530b"),e=e(),ee(),e),Ye={class:"home"},Ze={class:"wrapper"},et=Xe(()=>t("i",{class:"iconfont icon-fanhui"},null,-1)),tt={class:"container"},ot=z({__name:"home",setup(e){const a=ae(),n=H(),c=We(),o=se(),_=$(()=>c.list),m=$(()=>o.list),p=$(()=>a.params.type),C=$(()=>+a.params.id),b=$(()=>p.value==="folder"),k=y(!0),h=y(null),x=y(!1),S=$(()=>_.value.find(l=>l.id===C.value)),E=async()=>{const l={name:"未命名文件夹",createdTime:new Date().getTime(),updatedTime:new Date().getTime()},f=await c.set(l);h.value=f,setTimeout(()=>{h.value=""},100)},r=()=>{n.push({name:"home"})},i=l=>{const f=_.value.find(M=>M.id===l.id);f.name=l.name,f.updatedTime=new Date().getTime(),c.set(f)},I=l=>{const f=_.value.find(M=>M.id===l.id);f.name=l.name,f.updatedTime=new Date().getTime(),o.set(f)},V=l=>{te.confirm("确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{c.del(l.id),oe({type:"success",message:"删除成功"})})},N=l=>{te.confirm("确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{o.del(l.id),oe({type:"success",message:"删除成功"})})},O=()=>{x.value=!0};W.on("createFolder",()=>{E()}),W.on("createChart",()=>{O()});const R=()=>{const l=new BroadcastChannel("chart");l.onmessage=async f=>{await c.update(),await o.update()}};return X(async()=>{var l;(l=document.querySelector("html"))==null||l.classList.remove("dark"),await c.update(),await o.update(),k.value=!1,R()}),(l,f)=>{const M=g("el-empty"),ie=he("loading");return s(),u("div",Ye,[v(d(Ce)),Y((s(),u("div",Ze,[d(b)&&d(S)?(s(),u("div",{key:0,class:"back",onClick:r},[et,T(" "+A(d(S).name),1)])):q("",!0),t("div",tt,[d(b)?q("",!0):(s(),u(j,{key:0},[(s(!0),u(j,null,U(d(_),F=>(s(),D(d(Be),{key:F.id,editId:h.value,folder:F,onChange:i,onDel:V},null,8,["editId","folder"]))),128)),(s(!0),u(j,null,U(d(m),F=>(s(),D(d(Ke),{key:F.id,chart:F,onChange:I,onDel:N},null,8,["chart"]))),128))],64))]),!d(_).length&&!d(m).length&&!k.value?(s(),D(M,{key:1,description:"当前内容为空","image-size":200})):q("",!0),x.value?(s(),D(d(Qe),{key:2,onClose:f[0]||(f[0]=F=>x.value=!1)})):q("",!0)])),[[ie,k.value]])])}}});const at=G(ot,[["__scopeId","data-v-7073530b"]]);export{at as default};
